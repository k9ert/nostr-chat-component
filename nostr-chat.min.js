/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const t=window,e=t.ShadowRoot&&(void 0===t.ShadyCSS||t.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,n=Symbol(),r=new WeakMap;let s=class{constructor(t,e,r){if(this._$cssResult$=!0,r!==n)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const n=this.t;if(e&&void 0===t){const e=void 0!==n&&1===n.length;e&&(t=r.get(n)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),e&&r.set(n,t))}return t}toString(){return this.cssText}};const o=e?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const n of t.cssRules)e+=n.cssText;return(t=>new s("string"==typeof t?t:t+"",void 0,n))(e)})(t):t
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;var i;const a=window,c=a.trustedTypes,l=c?c.emptyScript:"",h=a.reactiveElementPolyfillSupport,u={toAttribute(t,e){switch(e){case Boolean:t=t?l:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let n=t;switch(e){case Boolean:n=null!==t;break;case Number:n=null===t?null:Number(t);break;case Object:case Array:try{n=JSON.parse(t)}catch(t){n=null}}return n}},d=(t,e)=>e!==t&&(e==e||t==t),f={attribute:!0,type:String,converter:u,reflect:!1,hasChanged:d},p="finalized";let g=class extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this._$Eu()}static addInitializer(t){var e;this.finalize(),(null!==(e=this.h)&&void 0!==e?e:this.h=[]).push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach(((e,n)=>{const r=this._$Ep(n,e);void 0!==r&&(this._$Ev.set(r,n),t.push(r))})),t}static createProperty(t,e=f){if(e.state&&(e.attribute=!1),this.finalize(),this.elementProperties.set(t,e),!e.noAccessor&&!this.prototype.hasOwnProperty(t)){const n="symbol"==typeof t?Symbol():"__"+t,r=this.getPropertyDescriptor(t,n,e);void 0!==r&&Object.defineProperty(this.prototype,t,r)}}static getPropertyDescriptor(t,e,n){return{get(){return this[e]},set(r){const s=this[t];this[e]=r,this.requestUpdate(t,s,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||f}static finalize(){if(this.hasOwnProperty(p))return!1;this[p]=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),void 0!==t.h&&(this.h=[...t.h]),this.elementProperties=new Map(t.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const t=this.properties,e=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const n of e)this.createProperty(n,t[n])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const n=new Set(t.flat(1/0).reverse());for(const t of n)e.unshift(o(t))}else void 0!==t&&e.push(o(t));return e}static _$Ep(t,e){const n=e.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof t?t.toLowerCase():void 0}_$Eu(){var t;this._$E_=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(t=this.constructor.h)||void 0===t||t.forEach((t=>t(this)))}addController(t){var e,n;(null!==(e=this._$ES)&&void 0!==e?e:this._$ES=[]).push(t),void 0!==this.renderRoot&&this.isConnected&&(null===(n=t.hostConnected)||void 0===n||n.call(t))}removeController(t){var e;null===(e=this._$ES)||void 0===e||e.splice(this._$ES.indexOf(t)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((t,e)=>{this.hasOwnProperty(e)&&(this._$Ei.set(e,this[e]),delete this[e])}))}createRenderRoot(){var n;const r=null!==(n=this.shadowRoot)&&void 0!==n?n:this.attachShadow(this.constructor.shadowRootOptions);return((n,r)=>{e?n.adoptedStyleSheets=r.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet)):r.forEach((e=>{const r=document.createElement("style"),s=t.litNonce;void 0!==s&&r.setAttribute("nonce",s),r.textContent=e.cssText,n.appendChild(r)}))})(r,this.constructor.elementStyles),r}connectedCallback(){var t;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(t=this._$ES)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostConnected)||void 0===e?void 0:e.call(t)}))}enableUpdating(t){}disconnectedCallback(){var t;null===(t=this._$ES)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostDisconnected)||void 0===e?void 0:e.call(t)}))}attributeChangedCallback(t,e,n){this._$AK(t,n)}_$EO(t,e,n=f){var r;const s=this.constructor._$Ep(t,n);if(void 0!==s&&!0===n.reflect){const o=(void 0!==(null===(r=n.converter)||void 0===r?void 0:r.toAttribute)?n.converter:u).toAttribute(e,n.type);this._$El=t,null==o?this.removeAttribute(s):this.setAttribute(s,o),this._$El=null}}_$AK(t,e){var n;const r=this.constructor,s=r._$Ev.get(t);if(void 0!==s&&this._$El!==s){const t=r.getPropertyOptions(s),o="function"==typeof t.converter?{fromAttribute:t.converter}:void 0!==(null===(n=t.converter)||void 0===n?void 0:n.fromAttribute)?t.converter:u;this._$El=s,this[s]=o.fromAttribute(e,t.type),this._$El=null}}requestUpdate(t,e,n){let r=!0;void 0!==t&&(((n=n||this.constructor.getPropertyOptions(t)).hasChanged||d)(this[t],e)?(this._$AL.has(t)||this._$AL.set(t,e),!0===n.reflect&&this._$El!==t&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(t,n))):r=!1),!this.isUpdatePending&&r&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((t,e)=>this[e]=t)),this._$Ei=void 0);let e=!1;const n=this._$AL;try{e=this.shouldUpdate(n),e?(this.willUpdate(n),null===(t=this._$ES)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostUpdate)||void 0===e?void 0:e.call(t)})),this.update(n)):this._$Ek()}catch(t){throw e=!1,this._$Ek(),t}e&&this._$AE(n)}willUpdate(t){}_$AE(t){var e;null===(e=this._$ES)||void 0===e||e.forEach((t=>{var e;return null===(e=t.hostUpdated)||void 0===e?void 0:e.call(t)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(t){return!0}update(t){void 0!==this._$EC&&(this._$EC.forEach(((t,e)=>this._$EO(e,this[e],t))),this._$EC=void 0),this._$Ek()}updated(t){}firstUpdated(t){}};
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var y;g[p]=!0,g.elementProperties=new Map,g.elementStyles=[],g.shadowRootOptions={mode:"open"},null==h||h({ReactiveElement:g}),(null!==(i=a.reactiveElementVersions)&&void 0!==i?i:a.reactiveElementVersions=[]).push("1.6.3");const w=window,m=w.trustedTypes,v=m?m.createPolicy("lit-html",{createHTML:t=>t}):void 0,b="$lit$",E=`lit$${(Math.random()+"").slice(9)}$`,$="?"+E,_=`<${$}>`,A=document,x=()=>A.createComment(""),S=t=>null===t||"object"!=typeof t&&"function"!=typeof t,k=Array.isArray,U="[ \t\n\f\r]",B=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,P=/-->/g,C=/>/g,I=RegExp(`>|${U}(?:([^\\s"'>=/]+)(${U}*=${U}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),N=/'/g,O=/"/g,T=/^(?:script|style|textarea|title)$/i,R=Symbol.for("lit-noChange"),L=Symbol.for("lit-nothing"),H=new WeakMap,M=A.createTreeWalker(A,129,null,!1);function D(t,e){if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==v?v.createHTML(e):e}let K=class t{constructor({strings:e,_$litType$:n},r){let s;this.parts=[];let o=0,i=0;const a=e.length-1,c=this.parts,[l,h]=((t,e)=>{const n=t.length-1,r=[];let s,o=2===e?"<svg>":"",i=B;for(let e=0;e<n;e++){const n=t[e];let a,c,l=-1,h=0;for(;h<n.length&&(i.lastIndex=h,c=i.exec(n),null!==c);)h=i.lastIndex,i===B?"!--"===c[1]?i=P:void 0!==c[1]?i=C:void 0!==c[2]?(T.test(c[2])&&(s=RegExp("</"+c[2],"g")),i=I):void 0!==c[3]&&(i=I):i===I?">"===c[0]?(i=null!=s?s:B,l=-1):void 0===c[1]?l=-2:(l=i.lastIndex-c[2].length,a=c[1],i=void 0===c[3]?I:'"'===c[3]?O:N):i===O||i===N?i=I:i===P||i===C?i=B:(i=I,s=void 0);const u=i===I&&t[e+1].startsWith("/>")?" ":"";o+=i===B?n+_:l>=0?(r.push(a),n.slice(0,l)+b+n.slice(l)+E+u):n+E+(-2===l?(r.push(void 0),e):u)}return[D(t,o+(t[n]||"<?>")+(2===e?"</svg>":"")),r]})(e,n);if(this.el=t.createElement(l,r),M.currentNode=this.el.content,2===n){const t=this.el.content,e=t.firstChild;e.remove(),t.append(...e.childNodes)}for(;null!==(s=M.nextNode())&&c.length<a;){if(1===s.nodeType){if(s.hasAttributes()){const t=[];for(const e of s.getAttributeNames())if(e.endsWith(b)||e.startsWith(E)){const n=h[i++];if(t.push(e),void 0!==n){const t=s.getAttribute(n.toLowerCase()+b).split(E),e=/([.?@])?(.*)/.exec(n);c.push({type:1,index:o,name:e[2],strings:t,ctor:"."===e[1]?G:"?"===e[1]?F:"@"===e[1]?Z:z})}else c.push({type:6,index:o})}for(const e of t)s.removeAttribute(e)}if(T.test(s.tagName)){const t=s.textContent.split(E),e=t.length-1;if(e>0){s.textContent=m?m.emptyScript:"";for(let n=0;n<e;n++)s.append(t[n],x()),M.nextNode(),c.push({type:2,index:++o});s.append(t[e],x())}}}else if(8===s.nodeType)if(s.data===$)c.push({type:2,index:o});else{let t=-1;for(;-1!==(t=s.data.indexOf(E,t+1));)c.push({type:7,index:o}),t+=E.length-1}o++}}static createElement(t,e){const n=A.createElement("template");return n.innerHTML=t,n}};function j(t,e,n=t,r){var s,o,i,a;if(e===R)return e;let c=void 0!==r?null===(s=n._$Co)||void 0===s?void 0:s[r]:n._$Cl;const l=S(e)?void 0:e._$litDirective$;return(null==c?void 0:c.constructor)!==l&&(null===(o=null==c?void 0:c._$AO)||void 0===o||o.call(c,!1),void 0===l?c=void 0:(c=new l(t),c._$AT(t,n,r)),void 0!==r?(null!==(i=(a=n)._$Co)&&void 0!==i?i:a._$Co=[])[r]=c:n._$Cl=c),void 0!==c&&(e=j(t,c._$AS(t,e.values),c,r)),e}let W=class{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){var e;const{el:{content:n},parts:r}=this._$AD,s=(null!==(e=null==t?void 0:t.creationScope)&&void 0!==e?e:A).importNode(n,!0);M.currentNode=s;let o=M.nextNode(),i=0,a=0,c=r[0];for(;void 0!==c;){if(i===c.index){let e;2===c.type?e=new q(o,o.nextSibling,this,t):1===c.type?e=new c.ctor(o,c.name,c.strings,this,t):6===c.type&&(e=new J(o,this,t)),this._$AV.push(e),c=r[++a]}i!==(null==c?void 0:c.index)&&(o=M.nextNode(),i++)}return M.currentNode=A,s}v(t){let e=0;for(const n of this._$AV)void 0!==n&&(void 0!==n.strings?(n._$AI(t,n,e),e+=n.strings.length-2):n._$AI(t[e])),e++}},q=class t{constructor(t,e,n,r){var s;this.type=2,this._$AH=L,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=n,this.options=r,this._$Cp=null===(s=null==r?void 0:r.isConnected)||void 0===s||s}get _$AU(){var t,e;return null!==(e=null===(t=this._$AM)||void 0===t?void 0:t._$AU)&&void 0!==e?e:this._$Cp}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===(null==t?void 0:t.nodeType)&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=j(this,t,e),S(t)?t===L||null==t||""===t?(this._$AH!==L&&this._$AR(),this._$AH=L):t!==this._$AH&&t!==R&&this._(t):void 0!==t._$litType$?this.g(t):void 0!==t.nodeType?this.$(t):(t=>k(t)||"function"==typeof(null==t?void 0:t[Symbol.iterator]))(t)?this.T(t):this._(t)}k(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}$(t){this._$AH!==t&&(this._$AR(),this._$AH=this.k(t))}_(t){this._$AH!==L&&S(this._$AH)?this._$AA.nextSibling.data=t:this.$(A.createTextNode(t)),this._$AH=t}g(t){var e;const{values:n,_$litType$:r}=t,s="number"==typeof r?this._$AC(t):(void 0===r.el&&(r.el=K.createElement(D(r.h,r.h[0]),this.options)),r);if((null===(e=this._$AH)||void 0===e?void 0:e._$AD)===s)this._$AH.v(n);else{const t=new W(s,this),e=t.u(this.options);t.v(n),this.$(e),this._$AH=t}}_$AC(t){let e=H.get(t.strings);return void 0===e&&H.set(t.strings,e=new K(t)),e}T(e){k(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let r,s=0;for(const o of e)s===n.length?n.push(r=new t(this.k(x()),this.k(x()),this,this.options)):r=n[s],r._$AI(o),s++;s<n.length&&(this._$AR(r&&r._$AB.nextSibling,s),n.length=s)}_$AR(t=this._$AA.nextSibling,e){var n;for(null===(n=this._$AP)||void 0===n||n.call(this,!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){var e;void 0===this._$AM&&(this._$Cp=t,null===(e=this._$AP)||void 0===e||e.call(this,t))}},z=class{constructor(t,e,n,r,s){this.type=1,this._$AH=L,this._$AN=void 0,this.element=t,this.name=e,this._$AM=r,this.options=s,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=L}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,n,r){const s=this.strings;let o=!1;if(void 0===s)t=j(this,t,e,0),o=!S(t)||t!==this._$AH&&t!==R,o&&(this._$AH=t);else{const r=t;let i,a;for(t=s[0],i=0;i<s.length-1;i++)a=j(this,r[n+i],e,i),a===R&&(a=this._$AH[i]),o||(o=!S(a)||a!==this._$AH[i]),a===L?t=L:t!==L&&(t+=(null!=a?a:"")+s[i+1]),this._$AH[i]=a}o&&!r&&this.j(t)}j(t){t===L?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=t?t:"")}},G=class extends z{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===L?void 0:t}};const V=m?m.emptyScript:"";let F=class extends z{constructor(){super(...arguments),this.type=4}j(t){t&&t!==L?this.element.setAttribute(this.name,V):this.element.removeAttribute(this.name)}},Z=class extends z{constructor(t,e,n,r,s){super(t,e,n,r,s),this.type=5}_$AI(t,e=this){var n;if((t=null!==(n=j(this,t,e,0))&&void 0!==n?n:L)===R)return;const r=this._$AH,s=t===L&&r!==L||t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive,o=t!==L&&(r===L||s);s&&this.element.removeEventListener(this.name,this,r),o&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,n;"function"==typeof this._$AH?this._$AH.call(null!==(n=null===(e=this.options)||void 0===e?void 0:e.host)&&void 0!==n?n:this.element,t):this._$AH.handleEvent(t)}},J=class{constructor(t,e,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){j(this,t)}};const Y=w.litHtmlPolyfillSupport;null==Y||Y(K,q),(null!==(y=w.litHtmlVersions)&&void 0!==y?y:w.litHtmlVersions=[]).push("2.8.0");
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const Q=window,X=Q.ShadowRoot&&(void 0===Q.ShadyCSS||Q.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,tt=Symbol(),et=new WeakMap;let nt=class{constructor(t,e,n){if(this._$cssResult$=!0,n!==tt)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(X&&void 0===t){const n=void 0!==e&&1===e.length;n&&(t=et.get(e)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),n&&et.set(e,t))}return t}toString(){return this.cssText}};const rt=(t,...e)=>{const n=1===t.length?t[0]:e.reduce(((e,n,r)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+t[r+1]),t[0]);return new nt(n,t,tt)},st=X?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const n of t.cssRules)e+=n.cssText;return(t=>new nt("string"==typeof t?t:t+"",void 0,tt))(e)})(t):t
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;var ot;const it=window,at=it.trustedTypes,ct=at?at.emptyScript:"",lt=it.reactiveElementPolyfillSupport,ht={toAttribute(t,e){switch(e){case Boolean:t=t?ct:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let n=t;switch(e){case Boolean:n=null!==t;break;case Number:n=null===t?null:Number(t);break;case Object:case Array:try{n=JSON.parse(t)}catch(t){n=null}}return n}},ut=(t,e)=>e!==t&&(e==e||t==t),dt={attribute:!0,type:String,converter:ht,reflect:!1,hasChanged:ut},ft="finalized";let pt=class extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this._$Eu()}static addInitializer(t){var e;this.finalize(),(null!==(e=this.h)&&void 0!==e?e:this.h=[]).push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach(((e,n)=>{const r=this._$Ep(n,e);void 0!==r&&(this._$Ev.set(r,n),t.push(r))})),t}static createProperty(t,e=dt){if(e.state&&(e.attribute=!1),this.finalize(),this.elementProperties.set(t,e),!e.noAccessor&&!this.prototype.hasOwnProperty(t)){const n="symbol"==typeof t?Symbol():"__"+t,r=this.getPropertyDescriptor(t,n,e);void 0!==r&&Object.defineProperty(this.prototype,t,r)}}static getPropertyDescriptor(t,e,n){return{get(){return this[e]},set(r){const s=this[t];this[e]=r,this.requestUpdate(t,s,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||dt}static finalize(){if(this.hasOwnProperty(ft))return!1;this[ft]=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),void 0!==t.h&&(this.h=[...t.h]),this.elementProperties=new Map(t.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const t=this.properties,e=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const n of e)this.createProperty(n,t[n])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const n=new Set(t.flat(1/0).reverse());for(const t of n)e.unshift(st(t))}else void 0!==t&&e.push(st(t));return e}static _$Ep(t,e){const n=e.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof t?t.toLowerCase():void 0}_$Eu(){var t;this._$E_=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(t=this.constructor.h)||void 0===t||t.forEach((t=>t(this)))}addController(t){var e,n;(null!==(e=this._$ES)&&void 0!==e?e:this._$ES=[]).push(t),void 0!==this.renderRoot&&this.isConnected&&(null===(n=t.hostConnected)||void 0===n||n.call(t))}removeController(t){var e;null===(e=this._$ES)||void 0===e||e.splice(this._$ES.indexOf(t)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((t,e)=>{this.hasOwnProperty(e)&&(this._$Ei.set(e,this[e]),delete this[e])}))}createRenderRoot(){var t;const e=null!==(t=this.shadowRoot)&&void 0!==t?t:this.attachShadow(this.constructor.shadowRootOptions);return((t,e)=>{X?t.adoptedStyleSheets=e.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet)):e.forEach((e=>{const n=document.createElement("style"),r=Q.litNonce;void 0!==r&&n.setAttribute("nonce",r),n.textContent=e.cssText,t.appendChild(n)}))})(e,this.constructor.elementStyles),e}connectedCallback(){var t;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(t=this._$ES)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostConnected)||void 0===e?void 0:e.call(t)}))}enableUpdating(t){}disconnectedCallback(){var t;null===(t=this._$ES)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostDisconnected)||void 0===e?void 0:e.call(t)}))}attributeChangedCallback(t,e,n){this._$AK(t,n)}_$EO(t,e,n=dt){var r;const s=this.constructor._$Ep(t,n);if(void 0!==s&&!0===n.reflect){const o=(void 0!==(null===(r=n.converter)||void 0===r?void 0:r.toAttribute)?n.converter:ht).toAttribute(e,n.type);this._$El=t,null==o?this.removeAttribute(s):this.setAttribute(s,o),this._$El=null}}_$AK(t,e){var n;const r=this.constructor,s=r._$Ev.get(t);if(void 0!==s&&this._$El!==s){const t=r.getPropertyOptions(s),o="function"==typeof t.converter?{fromAttribute:t.converter}:void 0!==(null===(n=t.converter)||void 0===n?void 0:n.fromAttribute)?t.converter:ht;this._$El=s,this[s]=o.fromAttribute(e,t.type),this._$El=null}}requestUpdate(t,e,n){let r=!0;void 0!==t&&(((n=n||this.constructor.getPropertyOptions(t)).hasChanged||ut)(this[t],e)?(this._$AL.has(t)||this._$AL.set(t,e),!0===n.reflect&&this._$El!==t&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(t,n))):r=!1),!this.isUpdatePending&&r&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((t,e)=>this[e]=t)),this._$Ei=void 0);let e=!1;const n=this._$AL;try{e=this.shouldUpdate(n),e?(this.willUpdate(n),null===(t=this._$ES)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostUpdate)||void 0===e?void 0:e.call(t)})),this.update(n)):this._$Ek()}catch(t){throw e=!1,this._$Ek(),t}e&&this._$AE(n)}willUpdate(t){}_$AE(t){var e;null===(e=this._$ES)||void 0===e||e.forEach((t=>{var e;return null===(e=t.hostUpdated)||void 0===e?void 0:e.call(t)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(t){return!0}update(t){void 0!==this._$EC&&(this._$EC.forEach(((t,e)=>this._$EO(e,this[e],t))),this._$EC=void 0),this._$Ek()}updated(t){}firstUpdated(t){}};
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var gt;pt[ft]=!0,pt.elementProperties=new Map,pt.elementStyles=[],pt.shadowRootOptions={mode:"open"},null==lt||lt({ReactiveElement:pt}),(null!==(ot=it.reactiveElementVersions)&&void 0!==ot?ot:it.reactiveElementVersions=[]).push("1.6.3");const yt=window,wt=yt.trustedTypes,mt=wt?wt.createPolicy("lit-html",{createHTML:t=>t}):void 0,vt="$lit$",bt=`lit$${(Math.random()+"").slice(9)}$`,Et="?"+bt,$t=`<${Et}>`,_t=document,At=()=>_t.createComment(""),xt=t=>null===t||"object"!=typeof t&&"function"!=typeof t,St=Array.isArray,kt="[ \t\n\f\r]",Ut=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Bt=/-->/g,Pt=/>/g,Ct=RegExp(`>|${kt}(?:([^\\s"'>=/]+)(${kt}*=${kt}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),It=/'/g,Nt=/"/g,Ot=/^(?:script|style|textarea|title)$/i,Tt=(t=>(e,...n)=>({_$litType$:t,strings:e,values:n}))(1),Rt=Symbol.for("lit-noChange"),Lt=Symbol.for("lit-nothing"),Ht=new WeakMap,Mt=_t.createTreeWalker(_t,129,null,!1);function Dt(t,e){if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==mt?mt.createHTML(e):e}const Kt=(t,e)=>{const n=t.length-1,r=[];let s,o=2===e?"<svg>":"",i=Ut;for(let e=0;e<n;e++){const n=t[e];let a,c,l=-1,h=0;for(;h<n.length&&(i.lastIndex=h,c=i.exec(n),null!==c);)h=i.lastIndex,i===Ut?"!--"===c[1]?i=Bt:void 0!==c[1]?i=Pt:void 0!==c[2]?(Ot.test(c[2])&&(s=RegExp("</"+c[2],"g")),i=Ct):void 0!==c[3]&&(i=Ct):i===Ct?">"===c[0]?(i=null!=s?s:Ut,l=-1):void 0===c[1]?l=-2:(l=i.lastIndex-c[2].length,a=c[1],i=void 0===c[3]?Ct:'"'===c[3]?Nt:It):i===Nt||i===It?i=Ct:i===Bt||i===Pt?i=Ut:(i=Ct,s=void 0);const u=i===Ct&&t[e+1].startsWith("/>")?" ":"";o+=i===Ut?n+$t:l>=0?(r.push(a),n.slice(0,l)+vt+n.slice(l)+bt+u):n+bt+(-2===l?(r.push(void 0),e):u)}return[Dt(t,o+(t[n]||"<?>")+(2===e?"</svg>":"")),r]};class jt{constructor({strings:t,_$litType$:e},n){let r;this.parts=[];let s=0,o=0;const i=t.length-1,a=this.parts,[c,l]=Kt(t,e);if(this.el=jt.createElement(c,n),Mt.currentNode=this.el.content,2===e){const t=this.el.content,e=t.firstChild;e.remove(),t.append(...e.childNodes)}for(;null!==(r=Mt.nextNode())&&a.length<i;){if(1===r.nodeType){if(r.hasAttributes()){const t=[];for(const e of r.getAttributeNames())if(e.endsWith(vt)||e.startsWith(bt)){const n=l[o++];if(t.push(e),void 0!==n){const t=r.getAttribute(n.toLowerCase()+vt).split(bt),e=/([.?@])?(.*)/.exec(n);a.push({type:1,index:s,name:e[2],strings:t,ctor:"."===e[1]?Vt:"?"===e[1]?Zt:"@"===e[1]?Jt:Gt})}else a.push({type:6,index:s})}for(const e of t)r.removeAttribute(e)}if(Ot.test(r.tagName)){const t=r.textContent.split(bt),e=t.length-1;if(e>0){r.textContent=wt?wt.emptyScript:"";for(let n=0;n<e;n++)r.append(t[n],At()),Mt.nextNode(),a.push({type:2,index:++s});r.append(t[e],At())}}}else if(8===r.nodeType)if(r.data===Et)a.push({type:2,index:s});else{let t=-1;for(;-1!==(t=r.data.indexOf(bt,t+1));)a.push({type:7,index:s}),t+=bt.length-1}s++}}static createElement(t,e){const n=_t.createElement("template");return n.innerHTML=t,n}}function Wt(t,e,n=t,r){var s,o,i,a;if(e===Rt)return e;let c=void 0!==r?null===(s=n._$Co)||void 0===s?void 0:s[r]:n._$Cl;const l=xt(e)?void 0:e._$litDirective$;return(null==c?void 0:c.constructor)!==l&&(null===(o=null==c?void 0:c._$AO)||void 0===o||o.call(c,!1),void 0===l?c=void 0:(c=new l(t),c._$AT(t,n,r)),void 0!==r?(null!==(i=(a=n)._$Co)&&void 0!==i?i:a._$Co=[])[r]=c:n._$Cl=c),void 0!==c&&(e=Wt(t,c._$AS(t,e.values),c,r)),e}class qt{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){var e;const{el:{content:n},parts:r}=this._$AD,s=(null!==(e=null==t?void 0:t.creationScope)&&void 0!==e?e:_t).importNode(n,!0);Mt.currentNode=s;let o=Mt.nextNode(),i=0,a=0,c=r[0];for(;void 0!==c;){if(i===c.index){let e;2===c.type?e=new zt(o,o.nextSibling,this,t):1===c.type?e=new c.ctor(o,c.name,c.strings,this,t):6===c.type&&(e=new Yt(o,this,t)),this._$AV.push(e),c=r[++a]}i!==(null==c?void 0:c.index)&&(o=Mt.nextNode(),i++)}return Mt.currentNode=_t,s}v(t){let e=0;for(const n of this._$AV)void 0!==n&&(void 0!==n.strings?(n._$AI(t,n,e),e+=n.strings.length-2):n._$AI(t[e])),e++}}class zt{constructor(t,e,n,r){var s;this.type=2,this._$AH=Lt,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=n,this.options=r,this._$Cp=null===(s=null==r?void 0:r.isConnected)||void 0===s||s}get _$AU(){var t,e;return null!==(e=null===(t=this._$AM)||void 0===t?void 0:t._$AU)&&void 0!==e?e:this._$Cp}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===(null==t?void 0:t.nodeType)&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=Wt(this,t,e),xt(t)?t===Lt||null==t||""===t?(this._$AH!==Lt&&this._$AR(),this._$AH=Lt):t!==this._$AH&&t!==Rt&&this._(t):void 0!==t._$litType$?this.g(t):void 0!==t.nodeType?this.$(t):(t=>St(t)||"function"==typeof(null==t?void 0:t[Symbol.iterator]))(t)?this.T(t):this._(t)}k(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}$(t){this._$AH!==t&&(this._$AR(),this._$AH=this.k(t))}_(t){this._$AH!==Lt&&xt(this._$AH)?this._$AA.nextSibling.data=t:this.$(_t.createTextNode(t)),this._$AH=t}g(t){var e;const{values:n,_$litType$:r}=t,s="number"==typeof r?this._$AC(t):(void 0===r.el&&(r.el=jt.createElement(Dt(r.h,r.h[0]),this.options)),r);if((null===(e=this._$AH)||void 0===e?void 0:e._$AD)===s)this._$AH.v(n);else{const t=new qt(s,this),e=t.u(this.options);t.v(n),this.$(e),this._$AH=t}}_$AC(t){let e=Ht.get(t.strings);return void 0===e&&Ht.set(t.strings,e=new jt(t)),e}T(t){St(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let n,r=0;for(const s of t)r===e.length?e.push(n=new zt(this.k(At()),this.k(At()),this,this.options)):n=e[r],n._$AI(s),r++;r<e.length&&(this._$AR(n&&n._$AB.nextSibling,r),e.length=r)}_$AR(t=this._$AA.nextSibling,e){var n;for(null===(n=this._$AP)||void 0===n||n.call(this,!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){var e;void 0===this._$AM&&(this._$Cp=t,null===(e=this._$AP)||void 0===e||e.call(this,t))}}class Gt{constructor(t,e,n,r,s){this.type=1,this._$AH=Lt,this._$AN=void 0,this.element=t,this.name=e,this._$AM=r,this.options=s,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=Lt}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,n,r){const s=this.strings;let o=!1;if(void 0===s)t=Wt(this,t,e,0),o=!xt(t)||t!==this._$AH&&t!==Rt,o&&(this._$AH=t);else{const r=t;let i,a;for(t=s[0],i=0;i<s.length-1;i++)a=Wt(this,r[n+i],e,i),a===Rt&&(a=this._$AH[i]),o||(o=!xt(a)||a!==this._$AH[i]),a===Lt?t=Lt:t!==Lt&&(t+=(null!=a?a:"")+s[i+1]),this._$AH[i]=a}o&&!r&&this.j(t)}j(t){t===Lt?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=t?t:"")}}class Vt extends Gt{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===Lt?void 0:t}}const Ft=wt?wt.emptyScript:"";class Zt extends Gt{constructor(){super(...arguments),this.type=4}j(t){t&&t!==Lt?this.element.setAttribute(this.name,Ft):this.element.removeAttribute(this.name)}}class Jt extends Gt{constructor(t,e,n,r,s){super(t,e,n,r,s),this.type=5}_$AI(t,e=this){var n;if((t=null!==(n=Wt(this,t,e,0))&&void 0!==n?n:Lt)===Rt)return;const r=this._$AH,s=t===Lt&&r!==Lt||t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive,o=t!==Lt&&(r===Lt||s);s&&this.element.removeEventListener(this.name,this,r),o&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,n;"function"==typeof this._$AH?this._$AH.call(null!==(n=null===(e=this.options)||void 0===e?void 0:e.host)&&void 0!==n?n:this.element,t):this._$AH.handleEvent(t)}}class Yt{constructor(t,e,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){Wt(this,t)}}const Qt=yt.litHtmlPolyfillSupport;null==Qt||Qt(jt,zt),(null!==(gt=yt.litHtmlVersions)&&void 0!==gt?gt:yt.litHtmlVersions=[]).push("2.8.0");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var Xt,te;class ee extends pt{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t,e;const n=super.createRenderRoot();return null!==(t=(e=this.renderOptions).renderBefore)&&void 0!==t||(e.renderBefore=n.firstChild),n}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=((t,e,n)=>{var r,s;const o=null!==(r=null==n?void 0:n.renderBefore)&&void 0!==r?r:e;let i=o._$litPart$;if(void 0===i){const t=null!==(s=null==n?void 0:n.renderBefore)&&void 0!==s?s:null;o._$litPart$=i=new zt(e.insertBefore(At(),t),t,void 0,null!=n?n:{})}return i._$AI(t),i})(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),null===(t=this._$Do)||void 0===t||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),null===(t=this._$Do)||void 0===t||t.setConnected(!1)}render(){return Rt}}ee.finalized=!0,ee._$litElement$=!0,null===(Xt=globalThis.litElementHydrateSupport)||void 0===Xt||Xt.call(globalThis,{LitElement:ee});const ne=globalThis.litElementPolyfillSupport;null==ne||ne({LitElement:ee}),(null!==(te=globalThis.litElementVersions)&&void 0!==te?te:globalThis.litElementVersions=[]).push("3.3.3");const re=rt`
  :host {
    display: block;
    font-family: var(--nostr-chat-font-family, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif);
    color: var(--nostr-chat-text-color, #333);
    --primary-color: var(--nostr-chat-primary-color, #3498db);
    --secondary-color: var(--nostr-chat-secondary-color, #2c7873);
    --background-color: var(--nostr-chat-background-color, #f9f9f9);
    --border-color: var(--nostr-chat-border-color, #ddd);
    --success-color: var(--nostr-chat-success-color, #27ae60);
    --error-color: var(--nostr-chat-error-color, #e74c3c);
    --self-message-bg: var(--nostr-chat-self-message-bg, #2c7873);
    --self-message-color: var(--nostr-chat-self-message-color, white);
    --others-message-bg: var(--nostr-chat-others-message-bg, white);
    --others-message-color: var(--nostr-chat-others-message-color, #333);
    --system-message-bg: var(--nostr-chat-system-message-bg, #f8f9fa);
    --system-message-color: var(--nostr-chat-system-message-color, #495057);
    --avatar-bg: var(--nostr-chat-avatar-bg, #3498db);
    --avatar-color: var(--nostr-chat-avatar-color, white);
    --input-bg: var(--nostr-chat-input-bg, white);
    --input-color: var(--nostr-chat-input-color, #333);
    --button-bg: var(--nostr-chat-button-bg, #3498db);
    --button-color: var(--nostr-chat-button-color, white);
    --link-color: var(--nostr-chat-link-color, #3498db);
    --timestamp-color: var(--nostr-chat-timestamp-color, #999);
    --username-color: var(--nostr-chat-username-color, #3498db);
    --border-radius: var(--nostr-chat-border-radius, 8px);
    --shadow: var(--nostr-chat-shadow, 0 1px 3px rgba(0, 0, 0, 0.1));
    --transition: var(--nostr-chat-transition, all 0.3s ease);
  }

  :host([theme="dark"]) {
    --primary-color: var(--nostr-chat-primary-color-dark, #3498db);
    --secondary-color: var(--nostr-chat-secondary-color-dark, #2c7873);
    --background-color: var(--nostr-chat-background-color-dark, #1a1a1a);
    --border-color: var(--nostr-chat-border-color-dark, #444);
    --text-color: var(--nostr-chat-text-color-dark, #f0f0f0);
    --self-message-bg: var(--nostr-chat-self-message-bg-dark, #2c7873);
    --self-message-color: var(--nostr-chat-self-message-color-dark, white);
    --others-message-bg: var(--nostr-chat-others-message-bg-dark, #2a2a2a);
    --others-message-color: var(--nostr-chat-others-message-color-dark, #f0f0f0);
    --system-message-bg: var(--nostr-chat-system-message-bg-dark, #2a2a2a);
    --system-message-color: var(--nostr-chat-system-message-color-dark, #aaa);
    --input-bg: var(--nostr-chat-input-bg-dark, #2a2a2a);
    --input-color: var(--nostr-chat-input-color-dark, #f0f0f0);
    --button-bg: var(--nostr-chat-button-bg-dark, #3498db);
    --button-color: var(--nostr-chat-button-color-dark, white);
    --link-color: var(--nostr-chat-link-color-dark, #3498db);
    --timestamp-color: var(--nostr-chat-timestamp-color-dark, #aaa);
    --username-color: var(--nostr-chat-username-color-dark, #3498db);
  }
`,se=rt`
  .nostr-chat-container {
    display: flex;
    flex-direction: column;
    height: 100%;
    background-color: var(--background-color);
    border-radius: var(--border-radius);
    overflow: hidden;
  }
`,oe=rt`
  .message-list {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .message-list::-webkit-scrollbar {
    width: 6px;
  }

  .message-list::-webkit-scrollbar-track {
    background: transparent;
  }

  .message-list::-webkit-scrollbar-thumb {
    background-color: var(--border-color);
    border-radius: 3px;
  }
`,ie=rt`
  .chat-message {
    padding: 12px;
    border-radius: var(--border-radius);
    max-width: 80%;
    word-wrap: break-word;
    margin-bottom: 10px;
    box-shadow: var(--shadow);
    transition: var(--transition);
  }

  .chat-message.self {
    align-self: flex-end;
    background-color: var(--self-message-bg);
    color: var(--self-message-color);
    margin-left: auto;
  }

  .chat-message.others {
    align-self: flex-start;
    background-color: var(--others-message-bg);
    color: var(--others-message-color);
    margin-right: auto;
    border-left: 3px solid var(--primary-color);
  }

  .chat-message.system-message {
    background-color: var(--system-message-bg);
    color: var(--system-message-color);
    border-left: 4px solid #6c757d;
    font-style: italic;
    max-width: 90%;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
  }

  .message-container {
    display: flex;
    gap: 10px;
    align-items: flex-start;
    width: 100%;
  }

  .chat-message.self .message-container {
    flex-direction: row-reverse;
  }

  .avatar-container {
    flex-shrink: 0;
    width: 40px;
    height: 40px;
  }

  .avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    color: var(--avatar-color);
    background-color: var(--avatar-bg);
    overflow: hidden;
  }

  .avatar-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
  }

  .content-container {
    flex: 1;
    min-width: 0;
  }

  .message-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.9em;
    margin-bottom: 8px;
  }

  .chat-message.self .message-header {
    flex-direction: row-reverse;
  }

  .username {
    font-weight: bold;
    color: var(--username-color);
  }

  .chat-message.self .username {
    color: var(--self-message-color);
    opacity: 0.9;
  }

  .timestamp {
    color: var(--timestamp-color);
    font-size: 0.8em;
  }

  .chat-message.self .timestamp {
    color: var(--self-message-color);
    opacity: 0.8;
  }

  .message-content {
    line-height: 1.5;
  }

  .message-text {
    margin-top: 5px;
  }

  .message-image {
    max-width: 100%;
    max-height: 300px;
    display: block;
    border-radius: var(--border-radius);
    margin-top: 10px;
  }

  .chat-message.self a {
    color: var(--self-message-color);
    opacity: 0.9;
    text-decoration: underline;
  }

  .chat-message a {
    color: var(--link-color);
    text-decoration: none;
  }

  .chat-message a:hover {
    text-decoration: underline;
  }

  .message-reactions {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-top: 8px;
  }

  .reaction {
    display: inline-flex;
    align-items: center;
    background-color: rgba(0, 0, 0, 0.05);
    border-radius: 12px;
    padding: 3px 8px;
    font-size: 0.9em;
    cursor: pointer;
  }

  .chat-message.self .reaction {
    background-color: rgba(255, 255, 255, 0.2);
  }

  .reaction-count {
    margin-left: 4px;
    font-size: 0.8em;
    opacity: 0.8;
  }
`,ae=rt`
  .input-area {
    display: flex;
    padding: 0.75rem;
    background-color: rgba(0, 0, 0, 0.03);
    border-top: 1px solid var(--border-color);
  }

  .message-input {
    flex: 1;
    padding: 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    font-family: inherit;
    font-size: 1rem;
    background-color: var(--input-bg);
    color: var(--input-color);
    resize: none;
    min-height: 40px;
    max-height: 120px;
    transition: var(--transition);
  }

  .message-input:focus {
    outline: none;
    border-color: var(--primary-color);
  }

  .send-button {
    margin-left: 0.5rem;
    padding: 0 1rem;
    background-color: var(--button-bg);
    color: var(--button-color);
    border: none;
    border-radius: var(--border-radius);
    cursor: pointer;
    font-weight: 500;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .send-button:hover {
    background-color: var(--primary-color);
    opacity: 0.9;
  }

  .send-button:disabled {
    background-color: var(--border-color);
    cursor: not-allowed;
  }

  .send-button svg {
    width: 20px;
    height: 20px;
  }
`,ce=rt`
  .loading-indicator {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.8);
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 10;
  }

  .spinner {
    width: 40px;
    height: 40px;
    border: 4px solid rgba(0, 0, 0, 0.1);
    border-radius: 50%;
    border-top-color: var(--primary-color);
    animation: spin 1s ease-in-out infinite;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }
`,le=[re,se,oe,ie,ae,ce],he=["wss://relay.damus.io","wss://relay.snort.social"],ue=0,de=40,fe=42,pe="wss://relay.damus.io",ge="nostr-chat-component-demo",ye="light",we=!0,me=50;function ve(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function be(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function Ee(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}const $e="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,_e=t=>t instanceof Uint8Array,Ae=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),xe=(t,e)=>t<<32-e|t>>>e;
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function Se(t){if("string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),!_e(t))throw new Error("expected Uint8Array, got "+typeof t);return t}let ke=class{clone(){return this._cloneInto()}};function Ue(t){const e=e=>t().update(Se(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Be(t=32){if($e&&"function"==typeof $e.getRandomValues)return $e.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}let Pe=class extends ke{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Ae(this.buffer)}update(t){Ee(this);const{view:e,buffer:n,blockLen:r}=this,s=(t=Se(t)).length;for(let o=0;o<s;){const i=Math.min(r-this.pos,s-o);if(i!==r)n.set(t.subarray(o,o+i),this.pos),this.pos+=i,o+=i,this.pos===r&&(this.process(e,0),this.pos=0);else{const e=Ae(t);for(;r<=s-o;o+=r)this.process(e,o)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){Ee(this),function(t,e){be(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:r,isLE:s}=this;let{pos:o}=this;e[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(n,0),o=0);for(let t=o;t<r;t++)e[t]=0;!function(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const s=BigInt(32),o=BigInt(4294967295),i=Number(n>>s&o),a=Number(n&o),c=r?4:0,l=r?0:4;t.setUint32(e+c,i,r),t.setUint32(e+l,a,r)}(n,r-8,BigInt(8*this.length),s),this.process(n,0);const i=Ae(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<c;t++)i.setUint32(4*t,l[t],s)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:s,destroyed:o,pos:i}=this;return t.length=r,t.pos=i,t.finished=s,t.destroyed=o,r%e&&t.buffer.set(n),t}};const Ce=(t,e,n)=>t&e^~t&n,Ie=(t,e,n)=>t&e^t&n^e&n,Ne=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Oe=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Te=new Uint32Array(64);let Re=class extends Pe{constructor(){super(64,32,8,!1),this.A=0|Oe[0],this.B=0|Oe[1],this.C=0|Oe[2],this.D=0|Oe[3],this.E=0|Oe[4],this.F=0|Oe[5],this.G=0|Oe[6],this.H=0|Oe[7]}get(){const{A:t,B:e,C:n,D:r,E:s,F:o,G:i,H:a}=this;return[t,e,n,r,s,o,i,a]}set(t,e,n,r,s,o,i,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|s,this.F=0|o,this.G=0|i,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)Te[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=Te[t-15],n=Te[t-2],r=xe(e,7)^xe(e,18)^e>>>3,s=xe(n,17)^xe(n,19)^n>>>10;Te[t]=s+Te[t-7]+r+Te[t-16]|0}let{A:n,B:r,C:s,D:o,E:i,F:a,G:c,H:l}=this;for(let t=0;t<64;t++){const e=l+(xe(i,6)^xe(i,11)^xe(i,25))+Ce(i,a,c)+Ne[t]+Te[t]|0,h=(xe(n,2)^xe(n,13)^xe(n,22))+Ie(n,r,s)|0;l=c,c=a,a=i,i=o+e|0,o=s,s=r,r=n,n=e+h|0}n=n+this.A|0,r=r+this.B|0,s=s+this.C|0,o=o+this.D|0,i=i+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,s,o,i,a,c,l)}roundClean(){Te.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Le=Ue((()=>new Re)),He=BigInt(0),Me=BigInt(1),De=BigInt(2),Ke=t=>t instanceof Uint8Array,je=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function We(t){if(!Ke(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=je[t[n]];return e}function qe(t){const e=t.toString(16);return 1&e.length?`0${e}`:e}function ze(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);return BigInt(""===t?"0":`0x${t}`)}function Ge(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let e=0;e<n.length;e++){const r=2*e,s=t.slice(r,r+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[e]=o}return n}function Ve(t){return ze(We(t))}function Fe(t){if(!Ke(t))throw new Error("Uint8Array expected");return ze(We(Uint8Array.from(t).reverse()))}function Ze(t,e){return Ge(t.toString(16).padStart(2*e,"0"))}function Je(t,e){return Ze(t,e).reverse()}function Ye(t,e,n){let r;if("string"==typeof e)try{r=Ge(e)}catch(n){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${n}`)}else{if(!Ke(e))throw new Error(`${t} must be hex string or Uint8Array`);r=Uint8Array.from(e)}const s=r.length;if("number"==typeof n&&s!==n)throw new Error(`${t} expected ${n} bytes, got ${s}`);return r}function Qe(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let n=0;return t.forEach((t=>{if(!Ke(t))throw new Error("Uint8Array expected");e.set(t,n),n+=t.length})),e}const Xe=t=>(De<<BigInt(t-1))-Me,tn=t=>new Uint8Array(t),en=t=>Uint8Array.from(t);function nn(t,e,n){if("number"!=typeof t||t<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=tn(t),s=tn(t),o=0;const i=()=>{r.fill(1),s.fill(0),o=0},a=(...t)=>n(s,r,...t),c=(t=tn())=>{s=a(en([0]),t),r=a(),0!==t.length&&(s=a(en([1]),t),r=a())},l=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let t=0;const n=[];for(;t<e;){r=a();const e=r.slice();n.push(e),t+=r.length}return Qe(...n)};return(t,e)=>{let n;for(i(),c(t);!(n=e(l()));)c();return i(),n}}const rn={bigint:t=>"bigint"==typeof t,function:t=>"function"==typeof t,boolean:t=>"boolean"==typeof t,string:t=>"string"==typeof t,stringOrUint8Array:t=>"string"==typeof t||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>"function"==typeof t&&Number.isSafeInteger(t.outputLen)};function sn(t,e,n={}){const r=(e,n,r)=>{const s=rn[n];if("function"!=typeof s)throw new Error(`Invalid validator "${n}", expected function`);const o=t[e];if(!(r&&void 0===o||s(o,t)))throw new Error(`Invalid param ${String(e)}=${o} (${typeof o}), expected ${n}`)};for(const[t,n]of Object.entries(e))r(t,n,!1);for(const[t,e]of Object.entries(n))r(t,e,!0);return t}var on=Object.freeze({__proto__:null,bitGet:function(t,e){return t>>BigInt(e)&Me},bitLen:function(t){let e;for(e=0;t>He;t>>=Me,e+=1);return e},bitMask:Xe,bitSet:(t,e,n)=>t|(n?Me:He)<<BigInt(e),bytesToHex:We,bytesToNumberBE:Ve,bytesToNumberLE:Fe,concatBytes:Qe,createHmacDrbg:nn,ensureBytes:Ye,equalBytes:function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0},hexToBytes:Ge,hexToNumber:ze,numberToBytesBE:Ze,numberToBytesLE:Je,numberToHexUnpadded:qe,numberToVarBytesBE:function(t){return Ge(qe(t))},utf8ToBytes:function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))},validateObject:sn});
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const an=BigInt(0),cn=BigInt(1),ln=BigInt(2),hn=BigInt(3),un=BigInt(4),dn=BigInt(5),fn=BigInt(8);function pn(t,e){const n=t%e;return n>=an?n:e+n}function gn(t,e,n){if(n<=an||e<an)throw new Error("Expected power/modulo > 0");if(n===cn)return an;let r=cn;for(;e>an;)e&cn&&(r=r*t%n),t=t*t%n,e>>=cn;return r}function yn(t,e,n){let r=t;for(;e-- >an;)r*=r,r%=n;return r}function wn(t,e){if(t===an||e<=an)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=pn(t,e),r=e,s=an,o=cn;for(;n!==an;){const t=r%n,e=s-o*(r/n);r=n,n=t,s=o,o=e}if(r!==cn)throw new Error("invert: does not exist");return pn(s,e)}function mn(t){if(t%un===hn){const e=(t+cn)/un;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}if(t%fn===dn){const e=(t-dn)/fn;return function(t,n){const r=t.mul(n,ln),s=t.pow(r,e),o=t.mul(n,s),i=t.mul(t.mul(o,ln),s),a=t.mul(o,t.sub(i,t.ONE));if(!t.eql(t.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(t){const e=(t-cn)/ln;let n,r,s;for(n=t-cn,r=0;n%ln===an;n/=ln,r++);for(s=ln;s<t&&gn(s,e,t)!==t-cn;s++);if(1===r){const e=(t+cn)/un;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}const o=(n+cn)/ln;return function(t,i){if(t.pow(i,e)===t.neg(t.ONE))throw new Error("Cannot find square root");let a=r,c=t.pow(t.mul(t.ONE,s),n),l=t.pow(i,o),h=t.pow(i,n);for(;!t.eql(h,t.ONE);){if(t.eql(h,t.ZERO))return t.ZERO;let e=1;for(let n=t.sqr(h);e<a&&!t.eql(n,t.ONE);e++)n=t.sqr(n);const n=t.pow(c,cn<<BigInt(a-e-1));c=t.sqr(n),l=t.mul(l,n),h=t.mul(h,c),a=e}return l}}(t)}BigInt(9),BigInt(16);const vn=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function bn(t,e){const n=void 0!==e?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function En(t){if("bigint"!=typeof t)throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function $n(t){const e=En(t);return e+Math.ceil(e/2)}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const _n=BigInt(0),An=BigInt(1);function xn(t){return sn(t.Fp,vn.reduce(((t,e)=>(t[e]="function",t)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),sn(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...bn(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const{bytesToNumberBE:Sn,hexToBytes:kn}=on,Un={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=Un;if(t.length<2||2!==t[0])throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(128&r[0])throw new e("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new e("Invalid signature integer: unnecessary leading zero");return{d:Sn(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=Un,n="string"==typeof t?kn(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:s,l:o}=Un._parseInt(n.subarray(2)),{d:i,l:a}=Un._parseInt(o);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:s,s:i}},hexFromSig(t){const e=t=>8&Number.parseInt(t[0],16)?"00"+t:t,n=t=>{const e=t.toString(16);return 1&e.length?`0${e}`:e},r=e(n(t.s)),s=e(n(t.r)),o=r.length/2,i=s.length/2,a=n(o),c=n(i);return`30${n(i+o+4)}02${c}${s}02${a}${r}`}},Bn=BigInt(0),Pn=BigInt(1);BigInt(2);const Cn=BigInt(3);function In(t){const e=function(t){const e=xn(t);sn(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:s}=e;if(n){if(!r.eql(s,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}(t),{Fp:n}=e,r=e.toBytes||((t,e,r)=>{const s=e.toAffine();return Qe(Uint8Array.from([4]),n.toBytes(s.x),n.toBytes(s.y))}),s=e.fromBytes||(t=>{const e=t.subarray(1);return{x:n.fromBytes(e.subarray(0,n.BYTES)),y:n.fromBytes(e.subarray(n.BYTES,2*n.BYTES))}});function o(t){const{a:r,b:s}=e,o=n.sqr(t),i=n.mul(o,t);return n.add(n.add(i,n.mul(t,r)),s)}if(!n.eql(n.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function i(t){return"bigint"==typeof t&&Bn<t&&t<e.n}function a(t){if(!i(t))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(t){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:s,n:o}=e;if(n&&"bigint"!=typeof t){if(t instanceof Uint8Array&&(t=We(t)),"string"!=typeof t||!n.includes(t.length))throw new Error("Invalid key");t=t.padStart(2*r,"0")}let i;try{i="bigint"==typeof t?t:Ve(Ye("private key",t,r))}catch(e){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof t}`)}return s&&(i=pn(i,o)),a(i),i}const l=new Map;function h(t){if(!(t instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(t,e,r){if(this.px=t,this.py=e,this.pz=r,null==t||!n.isValid(t))throw new Error("x required");if(null==e||!n.isValid(e))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(t){const{x:e,y:r}=t||{};if(!t||!n.isValid(e)||!n.isValid(r))throw new Error("invalid affine point");if(t instanceof u)throw new Error("projective point not allowed");const s=t=>n.eql(t,n.ZERO);return s(e)&&s(r)?u.ZERO:new u(e,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(t){const e=n.invertBatch(t.map((t=>t.pz)));return t.map(((t,n)=>t.toAffine(e[n]))).map(u.fromAffine)}static fromHex(t){const e=u.fromAffine(s(Ye("pointHex",t)));return e.assertValidity(),e}static fromPrivateKey(t){return u.BASE.multiply(c(t))}_setWindowSize(t){this._WINDOW_SIZE=t,l.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:t,y:r}=this.toAffine();if(!n.isValid(t)||!n.isValid(r))throw new Error("bad point: x or y not FE");const s=n.sqr(r),i=o(t);if(!n.eql(s,i))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:t}=this.toAffine();if(n.isOdd)return!n.isOdd(t);throw new Error("Field doesn't support isOdd")}equals(t){h(t);const{px:e,py:r,pz:s}=this,{px:o,py:i,pz:a}=t,c=n.eql(n.mul(e,a),n.mul(o,s)),l=n.eql(n.mul(r,a),n.mul(i,s));return c&&l}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){const{a:t,b:r}=e,s=n.mul(r,Cn),{px:o,py:i,pz:a}=this;let c=n.ZERO,l=n.ZERO,h=n.ZERO,d=n.mul(o,o),f=n.mul(i,i),p=n.mul(a,a),g=n.mul(o,i);return g=n.add(g,g),h=n.mul(o,a),h=n.add(h,h),c=n.mul(t,h),l=n.mul(s,p),l=n.add(c,l),c=n.sub(f,l),l=n.add(f,l),l=n.mul(c,l),c=n.mul(g,c),h=n.mul(s,h),p=n.mul(t,p),g=n.sub(d,p),g=n.mul(t,g),g=n.add(g,h),h=n.add(d,d),d=n.add(h,d),d=n.add(d,p),d=n.mul(d,g),l=n.add(l,d),p=n.mul(i,a),p=n.add(p,p),d=n.mul(p,g),c=n.sub(c,d),h=n.mul(p,f),h=n.add(h,h),h=n.add(h,h),new u(c,l,h)}add(t){h(t);const{px:r,py:s,pz:o}=this,{px:i,py:a,pz:c}=t;let l=n.ZERO,d=n.ZERO,f=n.ZERO;const p=e.a,g=n.mul(e.b,Cn);let y=n.mul(r,i),w=n.mul(s,a),m=n.mul(o,c),v=n.add(r,s),b=n.add(i,a);v=n.mul(v,b),b=n.add(y,w),v=n.sub(v,b),b=n.add(r,o);let E=n.add(i,c);return b=n.mul(b,E),E=n.add(y,m),b=n.sub(b,E),E=n.add(s,o),l=n.add(a,c),E=n.mul(E,l),l=n.add(w,m),E=n.sub(E,l),f=n.mul(p,b),l=n.mul(g,m),f=n.add(l,f),l=n.sub(w,f),f=n.add(w,f),d=n.mul(l,f),w=n.add(y,y),w=n.add(w,y),m=n.mul(p,m),b=n.mul(g,b),w=n.add(w,m),m=n.sub(y,m),m=n.mul(p,m),b=n.add(b,m),y=n.mul(w,b),d=n.add(d,y),y=n.mul(E,b),l=n.mul(v,l),l=n.sub(l,y),y=n.mul(v,w),f=n.mul(E,f),f=n.add(f,y),new u(l,d,f)}subtract(t){return this.add(t.negate())}is0(){return this.equals(u.ZERO)}wNAF(t){return f.wNAFCached(this,l,t,(t=>{const e=n.invertBatch(t.map((t=>t.pz)));return t.map(((t,n)=>t.toAffine(e[n]))).map(u.fromAffine)}))}multiplyUnsafe(t){const r=u.ZERO;if(t===Bn)return r;if(a(t),t===Pn)return this;const{endo:s}=e;if(!s)return f.unsafeLadder(this,t);let{k1neg:o,k1:i,k2neg:c,k2:l}=s.splitScalar(t),h=r,d=r,p=this;for(;i>Bn||l>Bn;)i&Pn&&(h=h.add(p)),l&Pn&&(d=d.add(p)),p=p.double(),i>>=Pn,l>>=Pn;return o&&(h=h.negate()),c&&(d=d.negate()),d=new u(n.mul(d.px,s.beta),d.py,d.pz),h.add(d)}multiply(t){a(t);let r,s,o=t;const{endo:i}=e;if(i){const{k1neg:t,k1:e,k2neg:a,k2:c}=i.splitScalar(o);let{p:l,f:h}=this.wNAF(e),{p:d,f:p}=this.wNAF(c);l=f.constTimeNegate(t,l),d=f.constTimeNegate(a,d),d=new u(n.mul(d.px,i.beta),d.py,d.pz),r=l.add(d),s=h.add(p)}else{const{p:t,f:e}=this.wNAF(o);r=t,s=e}return u.normalizeZ([r,s])[0]}multiplyAndAddUnsafe(t,e,n){const r=u.BASE,s=(t,e)=>e!==Bn&&e!==Pn&&t.equals(r)?t.multiply(e):t.multiplyUnsafe(e),o=s(this,e).add(s(t,n));return o.is0()?void 0:o}toAffine(t){const{px:e,py:r,pz:s}=this,o=this.is0();null==t&&(t=o?n.ONE:n.inv(s));const i=n.mul(e,t),a=n.mul(r,t),c=n.mul(s,t);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw new Error("invZ was invalid");return{x:i,y:a}}isTorsionFree(){const{h:t,isTorsionFree:n}=e;if(t===Pn)return!0;if(n)return n(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:t,clearCofactor:n}=e;return t===Pn?this:n?n(u,this):this.multiplyUnsafe(e.h)}toRawBytes(t=!0){return this.assertValidity(),r(u,this,t)}toHex(t=!0){return We(this.toRawBytes(t))}}u.BASE=new u(e.Gx,e.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);const d=e.nBitLength,f=function(t,e){const n=(t,e)=>{const n=e.negate();return t?n:e},r=t=>({windows:Math.ceil(e/t)+1,windowSize:2**(t-1)});return{constTimeNegate:n,unsafeLadder(e,n){let r=t.ZERO,s=e;for(;n>_n;)n&An&&(r=r.add(s)),s=s.double(),n>>=An;return r},precomputeWindow(t,e){const{windows:n,windowSize:s}=r(e),o=[];let i=t,a=i;for(let t=0;t<n;t++){a=i,o.push(a);for(let t=1;t<s;t++)a=a.add(i),o.push(a);i=a.double()}return o},wNAF(e,s,o){const{windows:i,windowSize:a}=r(e);let c=t.ZERO,l=t.BASE;const h=BigInt(2**e-1),u=2**e,d=BigInt(e);for(let t=0;t<i;t++){const e=t*a;let r=Number(o&h);o>>=d,r>a&&(r-=u,o+=An);const i=e,f=e+Math.abs(r)-1,p=t%2!=0,g=r<0;0===r?l=l.add(n(p,s[i])):c=c.add(n(g,s[f]))}return{p:c,f:l}},wNAFCached(t,e,n,r){const s=t._WINDOW_SIZE||1;let o=e.get(t);return o||(o=this.precomputeWindow(t,s),1!==s&&e.set(t,r(o))),this.wNAF(s,o,n)}}}(u,e.endo?Math.ceil(d/2):d);return{CURVE:e,ProjectivePoint:u,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:i}}function Nn(t){const e=function(t){const e=xn(t);return sn(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}(t),{Fp:n,n:r}=e,s=n.BYTES+1,o=2*n.BYTES+1;function i(t){return pn(t,r)}function a(t){return wn(t,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:h,isWithinCurveOrder:u}=In({...e,toBytes(t,e,r){const s=e.toAffine(),o=n.toBytes(s.x),i=Qe;return r?i(Uint8Array.from([e.hasEvenY()?2:3]),o):i(Uint8Array.from([4]),o,n.toBytes(s.y))},fromBytes(t){const e=t.length,r=t[0],i=t.subarray(1);if(e!==s||2!==r&&3!==r){if(e===o&&4===r){return{x:n.fromBytes(i.subarray(0,n.BYTES)),y:n.fromBytes(i.subarray(n.BYTES,2*n.BYTES))}}throw new Error(`Point of length ${e} was invalid. Expected ${s} compressed bytes or ${o} uncompressed bytes`)}{const t=Ve(i);if(!(Bn<(a=t)&&a<n.ORDER))throw new Error("Point is not on curve");const e=h(t);let s=n.sqrt(e);return!(1&~r)!==((s&Pn)===Pn)&&(s=n.neg(s)),{x:t,y:s}}var a}}),d=t=>We(Ze(t,e.nByteLength));function f(t){return t>r>>Pn}const p=(t,e,n)=>Ve(t.slice(e,n));class g{constructor(t,e,n){this.r=t,this.s=e,this.recovery=n,this.assertValidity()}static fromCompact(t){const n=e.nByteLength;return t=Ye("compactSignature",t,2*n),new g(p(t,0,n),p(t,n,2*n))}static fromDER(t){const{r:e,s:n}=Un.toSig(Ye("DER",t));return new g(e,n)}assertValidity(){if(!u(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!u(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(t){return new g(this.r,this.s,t)}recoverPublicKey(t){const{r:r,s:s,recovery:o}=this,l=v(Ye("msgHash",t));if(null==o||![0,1,2,3].includes(o))throw new Error("recovery id invalid");const h=2===o||3===o?r+e.n:r;if(h>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const u=1&o?"03":"02",f=c.fromHex(u+d(h)),p=a(h),g=i(-l*p),y=i(s*p),w=c.BASE.multiplyAndAddUnsafe(f,g,y);if(!w)throw new Error("point at infinify");return w.assertValidity(),w}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,i(-this.s),this.recovery):this}toDERRawBytes(){return Ge(this.toDERHex())}toDERHex(){return Un.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ge(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const y={isValidPrivateKey(t){try{return l(t),!0}catch(t){return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const t=$n(e.n);return function(t,e,n=!1){const r=t.length,s=En(e),o=$n(e);if(r<16||r<o||r>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${r}`);const i=pn(n?Ve(t):Fe(t),e-cn)+cn;return n?Je(i,s):Ze(i,s)}(e.randomBytes(t),e.n)},precompute:(t=8,e=c.BASE)=>(e._setWindowSize(t),e.multiply(BigInt(3)),e)};function w(t){const e=t instanceof Uint8Array,n="string"==typeof t,r=(e||n)&&t.length;return e?r===s||r===o:n?r===2*s||r===2*o:t instanceof c}const m=e.bits2int||function(t){const n=Ve(t),r=8*t.length-e.nBitLength;return r>0?n>>BigInt(r):n},v=e.bits2int_modN||function(t){return i(m(t))},b=Xe(e.nBitLength);function E(t){if("bigint"!=typeof t)throw new Error("bigint expected");if(!(Bn<=t&&t<b))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Ze(t,e.nByteLength)}function $(t,r,s=_){if(["recovered","canonical"].some((t=>t in s)))throw new Error("sign() legacy options not supported");const{hash:o,randomBytes:h}=e;let{lowS:d,prehash:p,extraEntropy:y}=s;null==d&&(d=!0),t=Ye("msgHash",t),p&&(t=Ye("prehashed msgHash",o(t)));const w=v(t),b=l(r),$=[E(b),E(w)];if(null!=y){const t=!0===y?h(n.BYTES):y;$.push(Ye("extraEntropy",t))}const A=Qe(...$),x=w;return{seed:A,k2sig:function(t){const e=m(t);if(!u(e))return;const n=a(e),r=c.BASE.multiply(e).toAffine(),s=i(r.x);if(s===Bn)return;const o=i(n*i(x+s*b));if(o===Bn)return;let l=(r.x===s?0:2)|Number(r.y&Pn),h=o;return d&&f(o)&&(h=function(t){return f(t)?i(-t):t}(o),l^=1),new g(s,h,l)}}}const _={lowS:e.lowS,prehash:!1},A={lowS:e.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(t,e=!0){return c.fromPrivateKey(t).toRawBytes(e)},getSharedSecret:function(t,e,n=!0){if(w(t))throw new Error("first arg must be private key");if(!w(e))throw new Error("second arg must be public key");return c.fromHex(e).multiply(l(t)).toRawBytes(n)},sign:function(t,n,r=_){const{seed:s,k2sig:o}=$(t,n,r),i=e;return nn(i.hash.outputLen,i.nByteLength,i.hmac)(s,o)},verify:function(t,n,r,s=A){const o=t;if(n=Ye("msgHash",n),r=Ye("publicKey",r),"strict"in s)throw new Error("options.strict was renamed to lowS");const{lowS:l,prehash:h}=s;let u,d;try{if("string"==typeof o||o instanceof Uint8Array)try{u=g.fromDER(o)}catch(t){if(!(t instanceof Un.Err))throw t;u=g.fromCompact(o)}else{if("object"!=typeof o||"bigint"!=typeof o.r||"bigint"!=typeof o.s)throw new Error("PARSE");{const{r:t,s:e}=o;u=new g(t,e)}}d=c.fromHex(r)}catch(t){if("PARSE"===t.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(l&&u.hasHighS())return!1;h&&(n=e.hash(n));const{r:f,s:p}=u,y=v(n),w=a(p),m=i(y*w),b=i(f*w),E=c.BASE.multiplyAndAddUnsafe(d,m,b)?.toAffine();return!!E&&i(E.x)===f},ProjectivePoint:c,Signature:g,utils:y}}BigInt(4);let On=class extends ke{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,function(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");ve(t.outputLen),ve(t.blockLen)}(t);const n=Se(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,s=new Uint8Array(r);s.set(n.length>r?t.create().update(n).digest():n);for(let t=0;t<s.length;t++)s[t]^=54;this.iHash.update(s),this.oHash=t.create();for(let t=0;t<s.length;t++)s[t]^=106;this.oHash.update(s),s.fill(0)}update(t){return Ee(this),this.iHash.update(t),this}digestInto(t){Ee(this),be(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:n,finished:r,destroyed:s,blockLen:o,outputLen:i}=this;return t.finished=r,t.destroyed=s,t.blockLen=o,t.outputLen=i,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Tn=(t,e,n)=>new On(t,e).update(n).digest();
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
function Rn(t){return{hash:t,hmac:(e,...n)=>Tn(t,e,function(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let n=0;return t.forEach((t=>{if(!_e(t))throw new Error("Uint8Array expected");e.set(t,n),n+=t.length})),e}(...n)),randomBytes:Be}}Tn.create=(t,e)=>new On(t,e);
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const Ln=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Hn=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Mn=BigInt(1),Dn=BigInt(2),Kn=(t,e)=>(t+e/Dn)/e;function jn(t){const e=Ln,n=BigInt(3),r=BigInt(6),s=BigInt(11),o=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,h=l*l*t%e,u=yn(h,n,e)*h%e,d=yn(u,n,e)*h%e,f=yn(d,Dn,e)*l%e,p=yn(f,s,e)*f%e,g=yn(p,o,e)*p%e,y=yn(g,a,e)*g%e,w=yn(y,c,e)*y%e,m=yn(w,a,e)*g%e,v=yn(m,n,e)*h%e,b=yn(v,i,e)*p%e,E=yn(b,r,e)*l%e,$=yn(E,Dn,e);if(!Wn.eql(Wn.sqr($),t))throw new Error("Cannot find square root");return $}const Wn=function(t,e,n=!1,r={}){if(t<=an)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:s,nByteLength:o}=bn(t,e);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const i=mn(t),a=Object.freeze({ORDER:t,BITS:s,BYTES:o,MASK:Xe(s),ZERO:an,ONE:cn,create:e=>pn(e,t),isValid:e=>{if("bigint"!=typeof e)throw new Error("Invalid field element: expected bigint, got "+typeof e);return an<=e&&e<t},is0:t=>t===an,isOdd:t=>(t&cn)===cn,neg:e=>pn(-e,t),eql:(t,e)=>t===e,sqr:e=>pn(e*e,t),add:(e,n)=>pn(e+n,t),sub:(e,n)=>pn(e-n,t),mul:(e,n)=>pn(e*n,t),pow:(t,e)=>function(t,e,n){if(n<an)throw new Error("Expected power > 0");if(n===an)return t.ONE;if(n===cn)return e;let r=t.ONE,s=e;for(;n>an;)n&cn&&(r=t.mul(r,s)),s=t.sqr(s),n>>=cn;return r}(a,t,e),div:(e,n)=>pn(e*wn(n,t),t),sqrN:t=>t*t,addN:(t,e)=>t+e,subN:(t,e)=>t-e,mulN:(t,e)=>t*e,inv:e=>wn(e,t),sqrt:r.sqrt||(t=>i(a,t)),invertBatch:t=>function(t,e){const n=new Array(e.length),r=e.reduce(((e,r,s)=>t.is0(r)?e:(n[s]=e,t.mul(e,r))),t.ONE),s=t.inv(r);return e.reduceRight(((e,r,s)=>t.is0(r)?e:(n[s]=t.mul(e,n[s]),t.mul(e,r))),s),n}(a,t),cmov:(t,e,n)=>n?e:t,toBytes:t=>n?Je(t,o):Ze(t,o),fromBytes:t=>{if(t.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${t.length}`);return n?Fe(t):Ve(t)}});return Object.freeze(a)}(Ln,void 0,void 0,{sqrt:jn}),qn=function(t,e){const n=e=>Nn({...t,...Rn(e)});return Object.freeze({...n(e),create:n})}({a:BigInt(0),b:BigInt(7),Fp:Wn,n:Hn,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Hn,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Mn*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=n,i=BigInt("0x100000000000000000000000000000000"),a=Kn(o*t,e),c=Kn(-r*t,e);let l=pn(t-a*n-c*s,e),h=pn(-a*r-c*o,e);const u=l>i,d=h>i;if(u&&(l=e-l),d&&(h=e-h),l>i||h>i)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:u,k1:l,k2neg:d,k2:h}}}},Le),zn=BigInt(0),Gn=t=>"bigint"==typeof t&&zn<t&&t<Ln,Vn={};function Fn(t,...e){let n=Vn[t];if(void 0===n){const e=Le(Uint8Array.from(t,(t=>t.charCodeAt(0))));n=Qe(e,e),Vn[t]=n}return Le(Qe(n,...e))}const Zn=t=>t.toRawBytes(!0).slice(1),Jn=t=>Ze(t,32),Yn=t=>pn(t,Ln),Qn=t=>pn(t,Hn),Xn=qn.ProjectivePoint;function tr(t){let e=qn.utils.normPrivateKeyToScalar(t),n=Xn.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:Qn(-e),bytes:Zn(n)}}function er(t){if(!Gn(t))throw new Error("bad x: need 0 < x < p");const e=Yn(t*t);let n=jn(Yn(e*t+BigInt(7)));n%Dn!==zn&&(n=Yn(-n));const r=new Xn(t,n,Mn);return r.assertValidity(),r}function nr(...t){return Qn(Ve(Fn("BIP0340/challenge",...t)))}function rr(t){return tr(t).bytes}function sr(t,e,n=Be(32)){const r=Ye("message",t),{bytes:s,scalar:o}=tr(e),i=Ye("auxRand",n,32),a=Jn(o^Ve(Fn("BIP0340/aux",i))),c=Fn("BIP0340/nonce",a,s,r),l=Qn(Ve(c));if(l===zn)throw new Error("sign failed: k is zero");const{bytes:h,scalar:u}=tr(l),d=nr(h,s,r),f=new Uint8Array(64);if(f.set(h,0),f.set(Jn(Qn(u+d*o)),32),!or(f,r,s))throw new Error("sign: Invalid signature produced");return f}function or(t,e,n){const r=Ye("signature",t,64),s=Ye("message",e),o=Ye("publicKey",n,32);try{const t=er(Ve(o)),e=Ve(r.subarray(0,32));if(!Gn(e))return!1;const n=Ve(r.subarray(32,64));if(!(t=>"bigint"==typeof t&&zn<t&&t<Hn)(n))return!1;const i=nr(Jn(e),Zn(t),s),a=((t,e,n)=>Xn.BASE.multiplyAndAddUnsafe(t,e,n))(t,n,Qn(-i));return!(!a||!a.hasEvenY()||a.toAffine().x!==e)}catch(t){return!1}}const ir=(()=>({getPublicKey:rr,sign:sr,verify:or,utils:{randomPrivateKey:qn.utils.randomPrivateKey,lift_x:er,pointToBytes:Zn,numberToBytesBE:Ze,bytesToNumberBE:Ve,taggedHash:Fn,mod:pn}}))(),ar="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,cr=t=>t instanceof Uint8Array,lr=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),hr=(t,e)=>t<<32-e|t>>>e;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");const ur=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function dr(t){if(!cr(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=ur[t[n]];return e}function fr(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let e=0;e<n.length;e++){const r=2*e,s=t.slice(r,r+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[e]=o}return n}function pr(t){if("string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),!cr(t))throw new Error("expected Uint8Array, got "+typeof t);return t}function gr(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let n=0;return t.forEach((t=>{if(!cr(t))throw new Error("Uint8Array expected");e.set(t,n),n+=t.length})),e}let yr=class{clone(){return this._cloneInto()}};function wr(t){const e=e=>t().update(pr(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function mr(t=32){if(ar&&"function"==typeof ar.getRandomValues)return ar.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function vr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function br(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}const Er={number:vr,bool:function(t){if("boolean"!=typeof t)throw new Error(`Expected boolean, not ${t}`)},bytes:br,hash:function(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");vr(t.outputLen),vr(t.blockLen)},exists:function(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")},output:function(t,e){br(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}};class $r extends yr{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=lr(this.buffer)}update(t){Er.exists(this);const{view:e,buffer:n,blockLen:r}=this,s=(t=pr(t)).length;for(let o=0;o<s;){const i=Math.min(r-this.pos,s-o);if(i!==r)n.set(t.subarray(o,o+i),this.pos),this.pos+=i,o+=i,this.pos===r&&(this.process(e,0),this.pos=0);else{const e=lr(t);for(;r<=s-o;o+=r)this.process(e,o)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){Er.exists(this),Er.output(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:r,isLE:s}=this;let{pos:o}=this;e[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(n,0),o=0);for(let t=o;t<r;t++)e[t]=0;!function(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const s=BigInt(32),o=BigInt(4294967295),i=Number(n>>s&o),a=Number(n&o),c=r?4:0,l=r?0:4;t.setUint32(e+c,i,r),t.setUint32(e+l,a,r)}(n,r-8,BigInt(8*this.length),s),this.process(n,0);const i=lr(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<c;t++)i.setUint32(4*t,l[t],s)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:s,destroyed:o,pos:i}=this;return t.length=r,t.pos=i,t.finished=s,t.destroyed=o,r%e&&t.buffer.set(n),t}}const _r=(t,e,n)=>t&e^~t&n,Ar=(t,e,n)=>t&e^t&n^e&n,xr=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Sr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),kr=new Uint32Array(64);let Ur=class extends $r{constructor(){super(64,32,8,!1),this.A=0|Sr[0],this.B=0|Sr[1],this.C=0|Sr[2],this.D=0|Sr[3],this.E=0|Sr[4],this.F=0|Sr[5],this.G=0|Sr[6],this.H=0|Sr[7]}get(){const{A:t,B:e,C:n,D:r,E:s,F:o,G:i,H:a}=this;return[t,e,n,r,s,o,i,a]}set(t,e,n,r,s,o,i,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|s,this.F=0|o,this.G=0|i,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)kr[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=kr[t-15],n=kr[t-2],r=hr(e,7)^hr(e,18)^e>>>3,s=hr(n,17)^hr(n,19)^n>>>10;kr[t]=s+kr[t-7]+r+kr[t-16]|0}let{A:n,B:r,C:s,D:o,E:i,F:a,G:c,H:l}=this;for(let t=0;t<64;t++){const e=l+(hr(i,6)^hr(i,11)^hr(i,25))+_r(i,a,c)+xr[t]+kr[t]|0,h=(hr(n,2)^hr(n,13)^hr(n,22))+Ar(n,r,s)|0;l=c,c=a,a=i,i=o+e|0,o=s,s=r,r=n,n=e+h|0}n=n+this.A|0,r=r+this.B|0,s=s+this.C|0,o=o+this.D|0,i=i+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,s,o,i,a,c,l)}roundClean(){kr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};class Br extends Ur{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Pr=wr((()=>new Ur));
/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */
function Cr(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function Ir(...t){const e=(t,e)=>n=>t(e(n)),n=Array.from(t).reverse().reduce(((t,n)=>t?e(t,n.encode):n.encode),void 0),r=t.reduce(((t,n)=>t?e(t,n.decode):n.decode),void 0);return{encode:n,decode:r}}function Nr(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("alphabet.encode input should be an array of numbers");return e.map((e=>{if(Cr(e),e<0||e>=t.length)throw new Error(`Digit index outside alphabet: ${e} (alphabet: ${t.length})`);return t[e]}))},decode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("alphabet.decode input should be array of strings");return e.map((e=>{if("string"!=typeof e)throw new Error(`alphabet.decode: not string element=${e}`);const n=t.indexOf(e);if(-1===n)throw new Error(`Unknown letter: "${e}". Allowed: ${t}`);return n}))}}}function Or(t=""){if("string"!=typeof t)throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("join.encode input should be array of strings");for(let t of e)if("string"!=typeof t)throw new Error(`join.encode: non-string input=${t}`);return e.join(t)},decode:e=>{if("string"!=typeof e)throw new Error("join.decode input should be string");return e.split(t)}}}function Tr(t,e="="){if(Cr(t),"string"!=typeof e)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.encode: non-string input=${t}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.decode: non-string input=${t}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function Rr(t){if("function"!=typeof t)throw new Error("normalize fn should be function");return{encode:t=>t,decode:e=>t(e)}}function Lr(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const s=[],o=Array.from(t);for(o.forEach((t=>{if(Cr(t),t<0||t>=e)throw new Error(`Wrong integer: ${t}`)}));;){let t=0,i=!0;for(let s=r;s<o.length;s++){const a=o[s],c=e*t+a;if(!Number.isSafeInteger(c)||e*t/e!==t||c-a!==e*t)throw new Error("convertRadix: carry overflow");if(t=c%n,o[s]=Math.floor(c/n),!Number.isSafeInteger(o[s])||o[s]*n+t!==c)throw new Error("convertRadix: carry overflow");i&&(o[s]?i=!1:r=s)}if(s.push(t),i)break}for(let e=0;e<t.length-1&&0===t[e];e++)s.push(0);return s.reverse()}wr((()=>new Br));const Hr=(t,e)=>e?Hr(e,t%e):t,Mr=(t,e)=>t+(e-Hr(t,e));function Dr(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Mr(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Mr(e,n)}`);let s=0,o=0;const i=2**n-1,a=[];for(const r of t){if(Cr(r),r>=2**e)throw new Error(`convertRadix2: invalid data word=${r} from=${e}`);if(s=s<<e|r,o+e>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${e}`);for(o+=e;o>=n;o-=n)a.push((s>>o-n&i)>>>0);s&=2**o-1}if(s=s<<n-o&i,!r&&o>=e)throw new Error("Excess padding");if(!r&&s)throw new Error(`Non-zero padding: ${s}`);return r&&o>0&&a.push(s>>>0),a}function Kr(t,e=!1){if(Cr(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Mr(8,t)>32||Mr(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Dr(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Dr(n,t,8,e))}}}function jr(t){if("function"!=typeof t)throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch(t){}}}const Wr=Ir(Kr(4),Nr("0123456789ABCDEF"),Or("")),qr=Ir(Kr(5),Nr("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Tr(5),Or(""));Ir(Kr(5),Nr("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Tr(5),Or("")),Ir(Kr(5),Nr("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Or(""),Rr((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))));const zr=Ir(Kr(6),Nr("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Tr(6),Or("")),Gr=Ir(Kr(6),Nr("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Tr(6),Or("")),Vr=t=>{return Ir((Cr(e=58),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Lr(Array.from(t),256,e)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Lr(t,e,256))}}),Nr(t),Or(""));var e},Fr=Vr("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Vr("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Vr("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Zr=[0,2,3,5,6,7,9,10,11],Jr={encode(t){let e="";for(let n=0;n<t.length;n+=8){const r=t.subarray(n,n+8);e+=Fr.encode(r).padStart(Zr[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){const r=t.slice(n,n+11),s=Zr.indexOf(r.length),o=Fr.decode(r);for(let t=0;t<o.length-s;t++)if(0!==o[t])throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(o.slice(o.length-s)))}return Uint8Array.from(e)}},Yr=Ir(Nr("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Or("")),Qr=[996825010,642813549,513874426,1027748829,705979059];function Xr(t){const e=t>>25;let n=(33554431&t)<<5;for(let t=0;t<Qr.length;t++)1==(e>>t&1)&&(n^=Qr[t]);return n}function ts(t,e,n=1){const r=t.length;let s=1;for(let e=0;e<r;e++){const n=t.charCodeAt(e);if(n<33||n>126)throw new Error(`Invalid prefix (${t})`);s=Xr(s)^n>>5}s=Xr(s);for(let e=0;e<r;e++)s=Xr(s)^31&t.charCodeAt(e);for(let t of e)s=Xr(s)^t;for(let t=0;t<6;t++)s=Xr(s);return s^=n,Yr.encode(Dr([s%2**30],30,5,!1))}function es(t){const e="bech32"===t?1:734539939,n=Kr(5),r=n.decode,s=n.encode,o=jr(r);function i(t,n=90){if("string"!=typeof t)throw new Error("bech32.decode input should be string, not "+typeof t);if(t.length<8||!1!==n&&t.length>n)throw new TypeError(`Wrong string length: ${t.length} (${t}). Expected (8..${n})`);const r=t.toLowerCase();if(t!==r&&t!==t.toUpperCase())throw new Error("String must be lowercase or uppercase");const s=(t=r).lastIndexOf("1");if(0===s||-1===s)throw new Error('Letter "1" must be present between prefix and data only');const o=t.slice(0,s),i=t.slice(s+1);if(i.length<6)throw new Error("Data must be at least 6 characters long");const a=Yr.decode(i).slice(0,-6),c=ts(o,a,e);if(!i.endsWith(c))throw new Error(`Invalid checksum in ${t}: expected "${c}"`);return{prefix:o,words:a}}return{encode:function(t,n,r=90){if("string"!=typeof t)throw new Error("bech32.encode prefix should be string, not "+typeof t);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const s=t.length+7+n.length;if(!1!==r&&s>r)throw new TypeError(`Length ${s} exceeds limit ${r}`);return`${t=t.toLowerCase()}1${Yr.encode(n)}${ts(t,n,e)}`},decode:i,decodeToBytes:function(t){const{prefix:e,words:n}=i(t,!1);return{prefix:e,words:n,bytes:r(n)}},decodeUnsafe:jr(i),fromWords:r,fromWordsUnsafe:o,toWords:s}}const ns=es("bech32");es("bech32m");const rs={encode:t=>(new TextDecoder).decode(t),decode:t=>(new TextEncoder).encode(t)},ss=Ir(Kr(4),Nr("0123456789abcdef"),Or(""),Rr((t=>{if("string"!=typeof t||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()}))),os={utf8:rs,hex:ss,base16:Wr,base32:qr,base64:zr,base64url:Gr,base58:Fr,base58xmr:Jr};function is(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function as(t){if("boolean"!=typeof t)throw new Error(`boolean expected, not ${t}`)}function cs(t,...e){if(!function(t){return t instanceof Uint8Array||null!=t&&"object"==typeof t&&"Uint8Array"===t.constructor.name}(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}
/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */Object.keys(os).join(", ");const ls=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4));if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");const hs=16;function us(t){return t<<1^283&-(t>>7)}function ds(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(1&e),t=us(t);return n}const fs=(()=>{let t=new Uint8Array(256);for(let e=0,n=1;e<256;e++,n^=us(n))t[e]=n;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return e})(),ps=fs.map(((t,e)=>fs.indexOf(e))),gs=t=>t<<24|t>>>8,ys=t=>t<<8|t>>>24;function ws(t,e){if(256!==t.length)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((n,r)=>e(t[r]))),r=n.map(ys),s=r.map(ys),o=s.map(ys),i=new Uint32Array(65536),a=new Uint32Array(65536),c=new Uint16Array(65536);for(let e=0;e<256;e++)for(let l=0;l<256;l++){const h=256*e+l;i[h]=n[e]^r[l],a[h]=s[e]^o[l],c[h]=t[e]<<8|t[l]}return{sbox:t,sbox2:c,T0:n,T1:r,T2:s,T3:o,T01:i,T23:a}}const ms=ws(fs,(t=>ds(t,3)<<24|t<<16|t<<8|ds(t,2))),vs=ws(ps,(t=>ds(t,11)<<24|ds(t,13)<<16|ds(t,9)<<8|ds(t,14))),bs=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=us(n))t[e]=n;return t})();function Es(t){cs(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=ms,r=ls(t),s=r.length,o=t=>_s(n,t,t,t,t),i=new Uint32Array(e+28);i.set(r);for(let t=s;t<i.length;t++){let e=i[t-1];t%s===0?e=o(gs(e))^bs[t/s-1]:s>6&&t%s===4&&(e=o(e)),i[t]=i[t-s]^e}return i}function $s(t,e,n,r,s,o){return t[n<<8&65280|r>>>8&255]^e[s>>>8&65280|o>>>24&255]}function _s(t,e,n,r,s){return t[255&e|65280&n]|t[r>>>16&255|s>>>16&65280]<<16}function As(t,e,n,r,s){const{sbox2:o,T01:i,T23:a}=ms;let c=0;e^=t[c++],n^=t[c++],r^=t[c++],s^=t[c++];const l=t.length/4-2;for(let o=0;o<l;o++){const o=t[c++]^$s(i,a,e,n,r,s),l=t[c++]^$s(i,a,n,r,s,e),h=t[c++]^$s(i,a,r,s,e,n),u=t[c++]^$s(i,a,s,e,n,r);e=o,n=l,r=h,s=u}return{s0:t[c++]^_s(o,e,n,r,s),s1:t[c++]^_s(o,n,r,s,e),s2:t[c++]^_s(o,r,s,e,n),s3:t[c++]^_s(o,s,e,n,r)}}function xs(t,e,n,r,s){const{sbox2:o,T01:i,T23:a}=vs;let c=0;e^=t[c++],n^=t[c++],r^=t[c++],s^=t[c++];const l=t.length/4-2;for(let o=0;o<l;o++){const o=t[c++]^$s(i,a,e,s,r,n),l=t[c++]^$s(i,a,n,e,s,r),h=t[c++]^$s(i,a,r,n,e,s),u=t[c++]^$s(i,a,s,r,n,e);e=o,n=l,r=h,s=u}return{s0:t[c++]^_s(o,e,s,r,n),s1:t[c++]^_s(o,n,e,s,r),s2:t[c++]^_s(o,r,n,e,s),s3:t[c++]^_s(o,s,r,n,e)}}function Ss(t,e){if(!e)return new Uint8Array(t);if(cs(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}const ks=((t,e)=>(Object.assign(e,t),e))({blockSize:16,nonceLength:16},(function(t,e,n={}){cs(t),cs(e,16);const r=!n.disablePadding;return{encrypt:(n,s)=>{const o=Es(t),{b:i,o:a,out:c}=function(t,e,n){let r=t.length;const s=r%hs;if(!e&&0!==s)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const o=ls(t);if(e){let t=hs-s;t||(t=hs),r+=t}const i=Ss(r,n);return{b:o,o:ls(i),out:i}}(n,r,s),l=ls(e);let h=l[0],u=l[1],d=l[2],f=l[3],p=0;for(;p+4<=i.length;)h^=i[p+0],u^=i[p+1],d^=i[p+2],f^=i[p+3],({s0:h,s1:u,s2:d,s3:f}=As(o,h,u,d,f)),a[p++]=h,a[p++]=u,a[p++]=d,a[p++]=f;if(r){const t=function(t){const e=new Uint8Array(16),n=ls(e);e.set(t);const r=hs-t.length;for(let t=hs-r;t<hs;t++)e[t]=r;return n}(n.subarray(4*p));h^=t[0],u^=t[1],d^=t[2],f^=t[3],({s0:h,s1:u,s2:d,s3:f}=As(o,h,u,d,f)),a[p++]=h,a[p++]=u,a[p++]=d,a[p++]=f}return o.fill(0),c},decrypt:(n,s)=>{!function(t){if(cs(t),t.length%hs!==0)throw new Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}(n);const o=function(t){const e=Es(t),n=e.slice(),r=e.length,{sbox2:s}=ms,{T0:o,T1:i,T2:a,T3:c}=vs;for(let t=0;t<r;t+=4)for(let s=0;s<4;s++)n[t+s]=e[r-t-4+s];e.fill(0);for(let t=4;t<r-4;t++){const e=n[t],r=_s(s,e,e,e,e);n[t]=o[255&r]^i[r>>>8&255]^a[r>>>16&255]^c[r>>>24]}return n}(t),i=ls(e),a=Ss(n.length,s),c=ls(n),l=ls(a);let h=i[0],u=i[1],d=i[2],f=i[3];for(let t=0;t+4<=c.length;){const e=h,n=u,r=d,s=f;h=c[t+0],u=c[t+1],d=c[t+2],f=c[t+3];const{s0:i,s1:a,s2:p,s3:g}=xs(o,h,u,d,f);l[t++]=i^e,l[t++]=a^n,l[t++]=p^r,l[t++]=g^s}return o.fill(0),function(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const s=t.subarray(0,-r);for(let e=0;e<r;e++)if(t[n-e-1]!==r)throw new Error("aes/pcks5: wrong padding");return s}(a,r)}}})),Us=t=>Uint8Array.from(t.split("").map((t=>t.charCodeAt(0)))),Bs=Us("expand 16-byte k"),Ps=Us("expand 32-byte k"),Cs=ls(Bs),Is=ls(Ps);function Ns(t,e){return t<<e|t>>>32-e}function Os(t){return t.byteOffset%4==0}Is.slice();const Ts=2**32-1,Rs=new Uint32Array;function Ls(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:s,counterRight:o,rounds:i}=function(t,e){if(null==e||"object"!=typeof e)throw new Error("options must be defined");return Object.assign(t,e)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if("function"!=typeof t)throw new Error("core must be a function");return is(s),is(i),as(o),as(n),(e,a,c,l,h=0)=>{cs(e),cs(a),cs(c);const u=c.length;if(l||(l=new Uint8Array(u)),cs(l),is(h),h<0||h>=Ts)throw new Error("arx: counter overflow");if(l.length<u)throw new Error(`arx: output (${l.length}) is shorter than data (${u})`);const d=[];let f,p,g=e.length;if(32===g)f=e.slice(),d.push(f),p=Is;else{if(16!==g||!n)throw new Error(`arx: invalid 32-byte key, got length=${g}`);f=new Uint8Array(32),f.set(e),f.set(e,16),p=Cs,d.push(f)}Os(a)||(a=a.slice(),d.push(a));const y=ls(f);if(r){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");r(p,y,ls(a.subarray(0,16)),y),a=a.subarray(16)}const w=16-s;if(w!==a.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(12!==w){const t=new Uint8Array(12);t.set(a,o?0:12-a.length),a=t,d.push(a)}const m=ls(a);for(!function(t,e,n,r,s,o,i,a){const c=s.length,l=new Uint8Array(64),h=ls(l),u=Os(s)&&Os(o),d=u?ls(s):Rs,f=u?ls(o):Rs;for(let p=0;p<c;i++){if(t(e,n,r,h,i,a),i>=Ts)throw new Error("arx: counter overflow");const g=Math.min(64,c-p);if(u&&64===g){const t=p/4;if(p%4!=0)throw new Error("arx: invalid block position");for(let e,n=0;n<16;n++)e=t+n,f[e]=d[e]^h[n];p+=64}else{for(let t,e=0;e<g;e++)t=p+e,o[t]=s[t]^l[e];p+=g}}}(t,p,y,m,c,l,h,i);d.length>0;)d.pop().fill(0);return l}}function Hs(t,e,n,r,s,o=20){let i=t[0],a=t[1],c=t[2],l=t[3],h=e[0],u=e[1],d=e[2],f=e[3],p=e[4],g=e[5],y=e[6],w=e[7],m=s,v=n[0],b=n[1],E=n[2],$=i,_=a,A=c,x=l,S=h,k=u,U=d,B=f,P=p,C=g,I=y,N=w,O=m,T=v,R=b,L=E;for(let t=0;t<o;t+=2)$=$+S|0,O=Ns(O^$,16),P=P+O|0,S=Ns(S^P,12),$=$+S|0,O=Ns(O^$,8),P=P+O|0,S=Ns(S^P,7),_=_+k|0,T=Ns(T^_,16),C=C+T|0,k=Ns(k^C,12),_=_+k|0,T=Ns(T^_,8),C=C+T|0,k=Ns(k^C,7),A=A+U|0,R=Ns(R^A,16),I=I+R|0,U=Ns(U^I,12),A=A+U|0,R=Ns(R^A,8),I=I+R|0,U=Ns(U^I,7),x=x+B|0,L=Ns(L^x,16),N=N+L|0,B=Ns(B^N,12),x=x+B|0,L=Ns(L^x,8),N=N+L|0,B=Ns(B^N,7),$=$+k|0,L=Ns(L^$,16),I=I+L|0,k=Ns(k^I,12),$=$+k|0,L=Ns(L^$,8),I=I+L|0,k=Ns(k^I,7),_=_+U|0,O=Ns(O^_,16),N=N+O|0,U=Ns(U^N,12),_=_+U|0,O=Ns(O^_,8),N=N+O|0,U=Ns(U^N,7),A=A+B|0,T=Ns(T^A,16),P=P+T|0,B=Ns(B^P,12),A=A+B|0,T=Ns(T^A,8),P=P+T|0,B=Ns(B^P,7),x=x+S|0,R=Ns(R^x,16),C=C+R|0,S=Ns(S^C,12),x=x+S|0,R=Ns(R^x,8),C=C+R|0,S=Ns(S^C,7);let H=0;r[H++]=i+$|0,r[H++]=a+_|0,r[H++]=c+A|0,r[H++]=l+x|0,r[H++]=h+S|0,r[H++]=u+k|0,r[H++]=d+U|0,r[H++]=f+B|0,r[H++]=p+P|0,r[H++]=g+C|0,r[H++]=y+I|0,r[H++]=w+N|0,r[H++]=m+O|0,r[H++]=v+T|0,r[H++]=b+R|0,r[H++]=E+L|0}const Ms=Ls(Hs,{counterRight:!1,counterLength:4,allowShortKeys:!1});class Ds extends yr{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Er.hash(t);const n=pr(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,s=new Uint8Array(r);s.set(n.length>r?t.create().update(n).digest():n);for(let t=0;t<s.length;t++)s[t]^=54;this.iHash.update(s),this.oHash=t.create();for(let t=0;t<s.length;t++)s[t]^=106;this.oHash.update(s),s.fill(0)}update(t){return Er.exists(this),this.iHash.update(t),this}digestInto(t){Er.exists(this),Er.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:n,finished:r,destroyed:s,blockLen:o,outputLen:i}=this;return t.finished=r,t.destroyed=s,t.blockLen=o,t.outputLen=i,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Ks=(t,e,n)=>new Ds(t,e).update(n).digest();Ks.create=(t,e)=>new Ds(t,e);const js=new Uint8Array([0]),Ws=new Uint8Array;var qs=Object.defineProperty,zs=(t,e)=>{for(var n in e)qs(t,n,{get:e[n],enumerable:!0})},Gs=Symbol("verified");function Vs(t){if(!(t instanceof Object))return!1;if("number"!=typeof t.kind)return!1;if("string"!=typeof t.content)return!1;if("number"!=typeof t.created_at)return!1;if("string"!=typeof t.pubkey)return!1;if(!t.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let t=0;t<n.length;t++)if("string"!=typeof n[t])return!1}return!0}zs({},{Queue:()=>eo,QueueNode:()=>to,binarySearch:()=>Xs,insertEventIntoAscendingList:()=>Qs,insertEventIntoDescendingList:()=>Ys,normalizeURL:()=>Js,utf8Decoder:()=>Fs,utf8Encoder:()=>Zs});var Fs=new TextDecoder("utf-8"),Zs=new TextEncoder;function Js(t){try{-1===t.indexOf("://")&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),("80"===e.port&&"ws:"===e.protocol||"443"===e.port&&"wss:"===e.protocol)&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}catch(e){throw new Error(`Invalid URL: ${t}`)}}function Ys(t,e){const[n,r]=Xs(t,(t=>e.id===t.id?0:e.created_at===t.created_at?-1:t.created_at-e.created_at));return r||t.splice(n,0,e),t}function Qs(t,e){const[n,r]=Xs(t,(t=>e.id===t.id?0:e.created_at===t.created_at?-1:e.created_at-t.created_at));return r||t.splice(n,0,e),t}function Xs(t,e){let n=0,r=t.length-1;for(;n<=r;){const s=Math.floor((n+r)/2),o=e(t[s]);if(0===o)return[s,!0];o<0?r=s-1:n=s+1}return[n,!1]}var to=class{value;next=null;prev=null;constructor(t){this.value=t}},eo=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new to(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}};function no(t){return dr(Pr(Zs.encode(function(t){if(!Vs(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}(t))))}var ro=new class{generateSecretKey(){return ir.utils.randomPrivateKey()}getPublicKey(t){return dr(ir.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=dr(ir.getPublicKey(e)),n.id=no(n),n.sig=dr(ir.sign(no(n),e)),n[Gs]=!0,n}verifyEvent(t){if("boolean"==typeof t[Gs])return t[Gs];const e=no(t);if(e!==t.id)return t[Gs]=!1,!1;try{const n=ir.verify(t.sig,e,t.pubkey);return t[Gs]=n,n}catch(e){return t[Gs]=!1,!1}}},so=ro.generateSecretKey,oo=ro.getPublicKey,io=ro.finalizeEvent,ao=ro.verifyEvent;function co(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function lo(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function ho(t){return 2e4<=t&&t<3e4}function uo(t){return 3e4<=t&&t<4e4}zs({},{Application:()=>ki,BadgeAward:()=>Ao,BadgeDefinition:()=>bi,BlockedRelaysList:()=>ei,BookmarkList:()=>Qo,Bookmarksets:()=>wi,Calendar:()=>Oi,CalendarEventRSVP:()=>Ti,ChannelCreation:()=>Uo,ChannelHideMessage:()=>Co,ChannelMessage:()=>Po,ChannelMetadata:()=>Bo,ChannelMuteUser:()=>Io,ClassifiedListing:()=>Pi,ClientAuth:()=>li,CommunitiesList:()=>Xo,CommunityDefinition:()=>Hi,CommunityPostApproval:()=>Ko,Contacts:()=>vo,CreateOrUpdateProduct:()=>_i,CreateOrUpdateStall:()=>$i,Curationsets:()=>mi,Date:()=>Ii,DirectMessageRelaysList:()=>oi,DraftClassifiedListing:()=>Ci,DraftLong:()=>xi,Emojisets:()=>Si,EncryptedDirectMessage:()=>bo,EventDeletion:()=>Eo,FileMetadata:()=>To,FileServerPreference:()=>ii,Followsets:()=>pi,GenericRepost:()=>ko,Genericlists:()=>gi,GiftWrap:()=>Oo,HTTPAuth:()=>fi,Handlerinformation:()=>Li,Handlerrecommendation:()=>Ri,Highlights:()=>Fo,InterestsList:()=>ri,Interestsets:()=>Ei,JobFeedback:()=>qo,JobRequest:()=>jo,JobResult:()=>Wo,Label:()=>Do,LightningPubRPC:()=>ci,LiveChatMessage:()=>Ro,LiveEvent:()=>Ui,LongFormArticle:()=>Ai,Metadata:()=>yo,Mutelist:()=>Zo,NWCWalletInfo:()=>ai,NWCWalletRequest:()=>hi,NWCWalletResponse:()=>ui,NostrConnect:()=>di,OpenTimestamps:()=>No,Pinlist:()=>Jo,PrivateDirectMessage:()=>So,ProblemTracker:()=>Lo,ProfileBadges:()=>vi,PublicChatsList:()=>ti,Reaction:()=>_o,RecommendRelay:()=>mo,RelayList:()=>Yo,Relaysets:()=>yi,Report:()=>Ho,Reporting:()=>Mo,Repost:()=>$o,Seal:()=>xo,SearchRelaysList:()=>ni,ShortTextNote:()=>wo,Time:()=>Ni,UserEmojiList:()=>si,UserStatuses:()=>Bi,Zap:()=>Vo,ZapGoal:()=>zo,ZapRequest:()=>Go,classifyKind:()=>po,isAddressableKind:()=>uo,isEphemeralKind:()=>ho,isKind:()=>go,isParameterizedReplaceableKind:()=>fo,isRegularKind:()=>co,isReplaceableKind:()=>lo});var fo=uo;function po(t){return co(t)?"regular":lo(t)?"replaceable":ho(t)?"ephemeral":uo(t)?"parameterized":"unknown"}function go(t,e){const n=e instanceof Array?e:[e];return Vs(t)&&n.includes(t.kind)||!1}var yo=0,wo=1,mo=2,vo=3,bo=4,Eo=5,$o=6,_o=7,Ao=8,xo=13,So=14,ko=16,Uo=40,Bo=41,Po=42,Co=43,Io=44,No=1040,Oo=1059,To=1063,Ro=1311,Lo=1971,Ho=1984,Mo=1984,Do=1985,Ko=4550,jo=5999,Wo=6999,qo=7e3,zo=9041,Go=9734,Vo=9735,Fo=9802,Zo=1e4,Jo=10001,Yo=10002,Qo=10003,Xo=10004,ti=10005,ei=10006,ni=10007,ri=10015,si=10030,oi=10050,ii=10096,ai=13194,ci=21e3,li=22242,hi=23194,ui=23195,di=24133,fi=27235,pi=3e4,gi=30001,yi=30002,wi=30003,mi=30004,vi=30008,bi=30009,Ei=30015,$i=30017,_i=30018,Ai=30023,xi=30024,Si=30030,ki=30078,Ui=30311,Bi=30315,Pi=30402,Ci=30403,Ii=31922,Ni=31923,Oi=31924,Ti=31925,Ri=31989,Li=31990,Hi=34550;function Mi(t,e){if(t.ids&&-1===t.ids.indexOf(e.id))return!1;if(t.kinds&&-1===t.kinds.indexOf(e.kind))return!1;if(t.authors&&-1===t.authors.indexOf(e.pubkey))return!1;for(let n in t)if("#"===n[0]){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([t,e])=>t===n.slice(1)&&-1!==r.indexOf(e))))return!1}return!(t.since&&e.created_at<t.since)&&!(t.until&&e.created_at>t.until)}function Di(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,s=t.slice(r).indexOf('"')+r+1;return t.slice(s,s+64)}function Ki(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,s=t.slice(r),o=Math.min(s.indexOf(","),s.indexOf("}"));return parseInt(s.slice(0,o),10)}function ji(t){let e=t.slice(0,22).indexOf('"EVENT"');if(-1===e)return null;let n=t.slice(e+7+1).indexOf('"');if(-1===n)return null;let r=e+7+1+n,s=t.slice(r+1,80).indexOf('"');if(-1===s)return null;let o=r+1+s;return t.slice(r+1,o)}function Wi(t,e){return e===Di(t,"id")}function qi(t,e){return e===Di(t,"pubkey")}function zi(t,e){return e===Ki(t,"kind")}zs({},{getHex64:()=>Di,getInt:()=>Ki,getSubscriptionId:()=>ji,matchEventId:()=>Wi,matchEventKind:()=>zi,matchEventPubkey:()=>qi});function Gi(t,e){return{kind:li,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}async function Vi(){return new Promise((t=>{const e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()}))}zs({},{makeAuthEvent:()=>Gi});var Fi=t=>(t[Gs]=!0,!0),Zi=class{url;_connected=!1;onclose=null;onnotice=t=>console.debug(`NOTICE from ${this.url}: ${t}`);_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new eo;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=Js(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static async connect(t,e){const n=new Zi(t,e);return await n.connect(),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise(((t,e)=>{this.connectionTimeoutHandle=setTimeout((()=>{e("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(t){return clearTimeout(this.connectionTimeoutHandle),void e(t)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=t=>{clearTimeout(this.connectionTimeoutHandle),e(t.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;!1!==this.handleNext();)await Vi();this.queueRunning=!1}handleNext(){const t=this.incomingMessageQueue.dequeue();if(!t)return!1;const e=ji(t);if(e){const n=this.openSubs.get(e);if(!n)return;const r=Di(t,"id"),s=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),s)return}try{let e=JSON.parse(t);switch(e[0]){case"EVENT":{const t=this.openSubs.get(e[1]),n=e[2];return void(this.verifyEvent(n)&&function(t,e){for(let n=0;n<t.length;n++)if(Mi(t[n],e))return!0;return!1}(t.filters,n)&&t.onevent(n))}case"COUNT":{const t=e[1],n=e[2],r=this.openCountRequests.get(t);return void(r&&(r.resolve(n.count),this.openCountRequests.delete(t)))}case"EOSE":{const t=this.openSubs.get(e[1]);if(!t)return;return void t.receivedEose()}case"OK":{const t=e[1],n=e[2],r=e[3],s=this.openEventPublishes.get(t);return void(s&&(clearTimeout(s.timeout),n?s.resolve(r):s.reject(new Error(r)),this.openEventPublishes.delete(t)))}case"CLOSED":{const t=e[1],n=this.openSubs.get(t);if(!n)return;return n.closed=!0,void n.close(e[2])}case"NOTICE":return void this.onnotice(e[1]);case"AUTH":return this.challenge=e[1],void this._onauth?.(e[1])}}catch(t){return}}async send(t){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(t)}))}async auth(t){const e=this.challenge;if(!e)throw new Error("can't perform auth, no challenge was received");return this.authPromise||(this.authPromise=new Promise((async(n,r)=>{const s=await t(Gi(this.url,e)),o=setTimeout((()=>{const t=this.openEventPublishes.get(s.id);t&&(t.reject(new Error("auth timed out")),this.openEventPublishes.delete(s.id))}),this.publishTimeout);this.openEventPublishes.set(s.id,{resolve:n,reject:r,timeout:o}),this.send('["AUTH",'+JSON.stringify(s)+"]")}))),this.authPromise}async publish(t){const e=new Promise(((e,n)=>{const r=setTimeout((()=>{const e=this.openEventPublishes.get(t.id);e&&(e.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))}),this.publishTimeout);this.openEventPublishes.set(t.id,{resolve:e,reject:n,timeout:r})}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((t,e)=>{this.openCountRequests.set(n,{resolve:t,reject:e})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){const n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;const n=e.id||(e.label?e.label+":":"sub:")+this.serial,r=new Ji(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},Ji=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(t=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,t)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(t)}};try{WebSocket}catch{}var Yi,Qi=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(t){this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation}async ensureRelay(t,e){t=Js(t);let n=this.relays.get(t);return n||(n=new Zi(t,{verifyEvent:this.trustedRelayURLs.has(t)?Fi:this.verifyEvent,websocketImplementation:this._WebSocket}),e?.connectionTimeout&&(n.connectionTimeout=e.connectionTimeout),this.relays.set(t,n)),await n.connect(),n}close(t){t.map(Js).forEach((t=>{this.relays.get(t)?.close()}))}subscribe(t,e,n){return this.subscribeMap(t.map((t=>({url:t,filter:e}))),n)}subscribeMany(t,e,n){return this.subscribeMap(t.flatMap((t=>e.map((e=>({url:t,filter:e}))))),n)}subscribeMap(t,e){this.trackRelays&&(e.receivedEvent=(t,e)=>{let n=this.seenOn.get(e);n||(n=new Set,this.seenOn.set(e,n)),n.add(t)});const n=new Set,r=[],s=[];let o=n=>{s[n]||(s[n]=!0,s.filter((t=>t)).length===t.length&&(e.oneose?.(),o=()=>{}))};const i=[];let a=(n,r)=>{i[n]||(o(n),i[n]=r,i.filter((t=>t)).length===t.length&&(e.onclose?.(i),a=()=>{}))};const c=t=>{if(e.alreadyHaveEvent?.(t))return!0;const r=n.has(t);return n.add(t),r},l=Promise.all(t.map((async({url:t,filter:n},s)=>{let i;t=Js(t);try{i=await this.ensureRelay(t,{connectionTimeout:e.maxWait?Math.max(.8*e.maxWait,e.maxWait-1e3):void 0})}catch(t){return void a(s,t?.message||String(t))}let l=i.subscribe([n],{...e,oneose:()=>o(s),onclose:t=>{t.startsWith("auth-required:")&&e.doauth?i.auth(e.doauth).then((()=>{i.subscribe([n],{...e,oneose:()=>o(s),onclose:t=>{a(s,t)},alreadyHaveEvent:c,eoseTimeout:e.maxWait})})).catch((t=>{a(s,`auth was required and attempted, but failed with: ${t}`)})):a(s,t)},alreadyHaveEvent:c,eoseTimeout:e.maxWait});r.push(l)})));return{async close(){await l,r.forEach((t=>{t.close()}))}}}subscribeManyMap(t,e){this.trackRelays&&(e.receivedEvent=(t,e)=>{let n=this.seenOn.get(e);n||(n=new Set,this.seenOn.set(e,n)),n.add(t)});const n=new Set,r=[],s=Object.keys(t).length,o=[];let i=t=>{o[t]||(o[t]=!0,o.filter((t=>t)).length===s&&(e.oneose?.(),i=()=>{}))};const a=[];let c=(t,n)=>{a[t]||(i(t),a[t]=n,a.filter((t=>t)).length===s&&(e.onclose?.(a),c=()=>{}))};const l=t=>{if(e.alreadyHaveEvent?.(t))return!0;const r=n.has(t);return n.add(t),r},h=Promise.all(Object.entries(t).map((async(t,n,s)=>{if(s.indexOf(t)!==n)return void c(n,"duplicate url");let o,[a,h]=t;a=Js(a);try{o=await this.ensureRelay(a,{connectionTimeout:e.maxWait?Math.max(.8*e.maxWait,e.maxWait-1e3):void 0})}catch(t){return void c(n,t?.message||String(t))}let u=o.subscribe(h,{...e,oneose:()=>i(n),onclose:t=>{t.startsWith("auth-required:")&&e.doauth?o.auth(e.doauth).then((()=>{o.subscribe(h,{...e,oneose:()=>i(n),onclose:t=>{c(n,t)},alreadyHaveEvent:l,eoseTimeout:e.maxWait})})).catch((t=>{c(n,`auth was required and attempted, but failed with: ${t}`)})):c(n,t)},alreadyHaveEvent:l,eoseTimeout:e.maxWait});r.push(u)})));return{async close(){await h,r.forEach((t=>{t.close()}))}}}subscribeEose(t,e,n){const r=this.subscribe(t,e,{...n,oneose(){r.close()}});return r}subscribeManyEose(t,e,n){const r=this.subscribeMany(t,e,{...n,oneose(){r.close()}});return r}async querySync(t,e,n){return new Promise((async r=>{const s=[];this.subscribeEose(t,e,{...n,onevent(t){s.push(t)},onclose(t){r(s)}})}))}async get(t,e,n){e.limit=1;const r=await this.querySync(t,e,n);return r.sort(((t,e)=>e.created_at-t.created_at)),r[0]||null}publish(t,e){return t.map(Js).map((async(t,n,r)=>{if(r.indexOf(t)!==n)return Promise.reject("duplicate url");let s=await this.ensureRelay(t);return s.publish(e).then((t=>{if(this.trackRelays){let t=this.seenOn.get(e.id);t||(t=new Set,this.seenOn.set(e.id,t)),t.add(s)}return t}))}))}listConnectionStatus(){const t=new Map;return this.relays.forEach(((e,n)=>t.set(n,e.connected))),t}destroy(){this.relays.forEach((t=>t.close())),this.relays=new Map}};try{Yi=WebSocket}catch{}var Xi=class extends Qi{constructor(){super({verifyEvent:ao,websocketImplementation:Yi})}};zs({},{BECH32_REGEX:()=>na,Bech32MaxSize:()=>ea,NostrTypeGuard:()=>ta,decode:()=>sa,decodeNostrURI:()=>ra,encodeBytes:()=>ha,naddrEncode:()=>fa,neventEncode:()=>da,noteEncode:()=>ca,nprofileEncode:()=>ua,npubEncode:()=>aa,nsecEncode:()=>ia});var ta={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},ea=5e3,na=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function ra(t){try{return t.startsWith("nostr:")&&(t=t.substring(6)),sa(t)}catch(t){return{type:"invalid",data:null}}}function sa(t){let{prefix:e,words:n}=ns.decode(t,ea),r=new Uint8Array(ns.fromWords(n));switch(e){case"nprofile":{let t=oa(r);if(!t[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(32!==t[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:dr(t[0][0]),relays:t[1]?t[1].map((t=>Fs.decode(t))):[]}}}case"nevent":{let t=oa(r);if(!t[0]?.[0])throw new Error("missing TLV 0 for nevent");if(32!==t[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(t[2]&&32!==t[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(t[3]&&4!==t[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:dr(t[0][0]),relays:t[1]?t[1].map((t=>Fs.decode(t))):[],author:t[2]?.[0]?dr(t[2][0]):void 0,kind:t[3]?.[0]?parseInt(dr(t[3][0]),16):void 0}}}case"naddr":{let t=oa(r);if(!t[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!t[2]?.[0])throw new Error("missing TLV 2 for naddr");if(32!==t[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!t[3]?.[0])throw new Error("missing TLV 3 for naddr");if(4!==t[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Fs.decode(t[0][0]),pubkey:dr(t[2][0]),kind:parseInt(dr(t[3][0]),16),relays:t[1]?t[1].map((t=>Fs.decode(t))):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:dr(r)};default:throw new Error(`unknown prefix ${e}`)}}function oa(t){let e={},n=t;for(;n.length>0;){let t=n[0],r=n[1],s=n.slice(2,2+r);if(n=n.slice(2+r),s.length<r)throw new Error(`not enough data to read on TLV ${t}`);e[t]=e[t]||[],e[t].push(s)}return e}function ia(t){return ha("nsec",t)}function aa(t){return ha("npub",fr(t))}function ca(t){return ha("note",fr(t))}function la(t,e){let n=ns.toWords(e);return ns.encode(t,n,ea)}function ha(t,e){return la(t,e)}function ua(t){return la("nprofile",pa({0:[fr(t.pubkey)],1:(t.relays||[]).map((t=>Zs.encode(t)))}))}function da(t){let e;return void 0!==t.kind&&(e=function(t){const e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=255&t,e}(t.kind)),la("nevent",pa({0:[fr(t.id)],1:(t.relays||[]).map((t=>Zs.encode(t))),2:t.author?[fr(t.author)]:[],3:e?[new Uint8Array(e)]:[]}))}function fa(t){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,t.kind,!1),la("naddr",pa({0:[Zs.encode(t.identifier)],1:(t.relays||[]).map((t=>Zs.encode(t))),2:[fr(t.pubkey)],3:[new Uint8Array(e)]}))}function pa(t){let e=[];return Object.entries(t).reverse().forEach((([t,n])=>{n.forEach((n=>{let r=new Uint8Array(n.length+2);r.set([parseInt(t)],0),r.set([n.length],1),r.set(n,2),e.push(r)}))})),gr(...e)}function ga(t,e,n){const r=t instanceof Uint8Array?dr(t):t,s=wa(qn.getSharedSecret(r,"02"+e));let o=Uint8Array.from(mr(16)),i=Zs.encode(n),a=ks(s,o).encrypt(i);return`${zr.encode(new Uint8Array(a))}?iv=${zr.encode(new Uint8Array(o.buffer))}`}function ya(t,e,n){const r=t instanceof Uint8Array?dr(t):t;let[s,o]=n.split("?iv="),i=wa(qn.getSharedSecret(r,"02"+e)),a=zr.decode(o),c=zr.decode(s),l=ks(i,a).decrypt(c);return Fs.decode(l)}function wa(t){return t.slice(1,33)}zs({},{decrypt:()=>ya,encrypt:()=>ga});zs({},{NIP05_REGEX:()=>va,isNip05:()=>ba,isValid:()=>Aa,queryProfile:()=>_a,searchDomain:()=>$a,useFetchImplementation:()=>Ea});var ma,va=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,ba=t=>va.test(t||"");try{ma=fetch}catch(Bt){}function Ea(t){ma=t}async function $a(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await ma(n,{redirect:"manual"});if(200!==r.status)throw Error("Wrong response code");return(await r.json()).names}catch(t){return{}}}async function _a(t){const e=t.match(va);if(!e)return null;const[,n="_",r]=e;try{const t=`https://${r}/.well-known/nostr.json?name=${n}`,e=await ma(t,{redirect:"manual"});if(200!==e.status)throw Error("Wrong response code");const s=await e.json(),o=s.names[n];return o?{pubkey:o,relays:s.relays?.[o]}:null}catch(t){return null}}async function Aa(t,e){const n=await _a(e);return!!n&&n.pubkey===t}function xa(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let s=t.tags.length-1;s>=0;s--){const o=t.tags[s];if("e"===o[0]&&o[1]){const[t,s,i,a,c]=o,l={id:s,relays:i?[i]:[],author:c};if("root"===a){e.root=l;continue}if("reply"===a){e.reply=l;continue}if("mention"===a){e.mentions.push(l);continue}n?r=l:n=l,e.mentions.push(l)}else{if("q"===o[0]&&o[1]){const[t,n,r]=o;e.quotes.push({id:n,relays:r?[r]:[]})}"p"===o[0]&&o[1]&&e.profiles.push({pubkey:o[1],relays:o[2]?[o[2]]:[]})}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach((t=>{if(!t)return;let n=e.mentions.indexOf(t);if(-1!==n&&e.mentions.splice(n,1),t.author){let n=e.profiles.find((e=>e.pubkey===t.author));n&&n.relays&&(t.relays||(t.relays=[]),n.relays.forEach((e=>{-1===t.relays?.indexOf(e)&&t.relays.push(e)})),n.relays=t.relays)}})),e.mentions.forEach((t=>{if(t.author){let n=e.profiles.find((e=>e.pubkey===t.author));n&&n.relays&&(t.relays||(t.relays=[]),n.relays.forEach((e=>{-1===t.relays.indexOf(e)&&t.relays.push(e)})),n.relays=t.relays)}})),e}zs({},{parse:()=>xa});zs({},{fetchRelayInformation:()=>ka,useFetchImplementation:()=>Sa});try{fetch}catch{}function Sa(t){0}async function ka(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}function Ua(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(0!==r){e+=Math.clz32(r);break}e+=32}return e}function Ba(t,e){let n=0;const r=t,s=["nonce",n.toString(),e.toString()];for(r.tags.push(s);;){const t=Math.floor((new Date).getTime()/1e3);if(t!==r.created_at&&(n=0,r.created_at=t),s[1]=(++n).toString(),r.id=Pa(r),Ua(r.id)>=e)break}return r}function Pa(t){return dr(Pr(Zs.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}zs({},{fastEventHash:()=>Pa,getPow:()=>Ua,minePow:()=>Ba});zs({},{unwrapEvent:()=>ec,unwrapManyEvents:()=>nc,wrapEvent:()=>Xa,wrapManyEvents:()=>tc});zs({},{createRumor:()=>Ga,createSeal:()=>Va,createWrap:()=>Fa,unwrapEvent:()=>Ya,unwrapManyEvents:()=>Qa,wrapEvent:()=>Za,wrapManyEvents:()=>Ja});zs({},{decrypt:()=>Ma,encrypt:()=>Ha,getConversationKey:()=>Na,v2:()=>Da});var Ca=1,Ia=65535;function Na(t,e){const n=qn.getSharedSecret(t,"02"+e).subarray(1,33);return function(t,e,n){return Er.hash(t),void 0===n&&(n=new Uint8Array(t.outputLen)),Ks(t,pr(n),pr(e))}(Pr,n,"nip44-v2")}function Oa(t,e){const n=function(t,e,n,r=32){if(Er.hash(t),Er.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(r/t.outputLen);void 0===n&&(n=Ws);const o=new Uint8Array(s*t.outputLen),i=Ks.create(t,e),a=i._cloneInto(),c=new Uint8Array(i.outputLen);for(let e=0;e<s;e++)js[0]=e+1,a.update(0===e?Ws:c).update(n).update(js).digestInto(c),o.set(c,t.outputLen*e),i._cloneInto(a);return i.destroy(),a.destroy(),c.fill(0),js.fill(0),o.slice(0,r)}(Pr,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function Ta(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function Ra(t){const e=Zs.encode(t),n=e.length;return gr(function(t){if(!Number.isSafeInteger(t)||t<Ca||t>Ia)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}(n),e,new Uint8Array(Ta(n)-n))}function La(t,e,n){if(32!==n.length)throw new Error("AAD associated data must be 32 bytes");const r=gr(n,e);return Ks(Pr,t,r)}function Ha(t,e,n=mr(32)){const{chacha_key:r,chacha_nonce:s,hmac_key:o}=Oa(e,n),i=Ra(t),a=Ms(r,s,i),c=La(o,a,n);return zr.encode(gr(new Uint8Array([2]),n,a,c))}function Ma(t,e){const{nonce:n,ciphertext:r,mac:s}=function(t){if("string"!=typeof t)throw new Error("payload must be a valid string");const e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if("#"===t[0])throw new Error("unknown encryption version");let n;try{n=zr.decode(t)}catch(t){throw new Error("invalid base64: "+t.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const s=n[0];if(2!==s)throw new Error("unknown encryption version "+s);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}(t),{chacha_key:o,chacha_nonce:i,hmac_key:a}=Oa(e,n);if(!function(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return 0===n}(La(a,r,n),s))throw new Error("invalid MAC");return function(t){const e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<Ca||e>Ia||n.length!==e||t.length!==2+Ta(e))throw new Error("invalid padding");return Fs.decode(n)}(Ms(o,i,r))}var Da={utils:{getConversationKey:Na,calcPaddedLen:Ta},encrypt:Ha,decrypt:Ma},Ka=()=>Math.round(Date.now()/1e3),ja=()=>Math.round(Ka()-172800*Math.random()),Wa=(t,e)=>Na(t,e),qa=(t,e,n)=>Ha(JSON.stringify(t),Wa(e,n)),za=(t,e)=>JSON.parse(Ma(t.content,Wa(e,t.pubkey)));function Ga(t,e){const n={created_at:Ka(),content:"",tags:[],...t,pubkey:oo(e)};return n.id=no(n),n}function Va(t,e,n){return io({kind:xo,content:qa(t,e,n),created_at:ja(),tags:[]},e)}function Fa(t,e){const n=so();return io({kind:Oo,content:qa(t,n,e),created_at:ja(),tags:[["p",e]]},n)}function Za(t,e,n){return Fa(Va(Ga(t,e),e,n),n)}function Ja(t,e,n){if(!n||0===n.length)throw new Error("At least one recipient is required.");const r=oo(e),s=[Za(t,e,r)];return n.forEach((n=>{s.push(Za(t,e,n))})),s}function Ya(t,e){const n=za(t,e);return za(n,e)}function Qa(t,e){let n=[];return t.forEach((t=>{n.push(Ya(t,e))})),n.sort(((t,e)=>t.created_at-e.created_at)),n}function Xa(t,e,n,r,s){const o=function(t,e,n,r){const s={created_at:Math.ceil(Date.now()/1e3),kind:So,tags:[],content:e};return(Array.isArray(t)?t:[t]).forEach((({publicKey:t,relayUrl:e})=>{s.tags.push(e?["p",t,e]:["p",t])})),r&&s.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&s.tags.push(["subject",n]),s}(e,n,r,s);return Za(o,t,e.publicKey)}function tc(t,e,n,r,s){if(!e||0===e.length)throw new Error("At least one recipient is required.");return[{publicKey:oo(t)},...e].map((e=>Xa(t,e,n,r,s)))}var ec=Ya,nc=Qa;function rc(t,e,n,r){let s;const o=[...t.tags??[],["e",e.id,n],["p",e.pubkey]];return e.kind===wo?s=$o:(s=ko,o.push(["k",String(e.kind)])),io({kind:s,tags:o,content:""===t.content||e.tags?.find((t=>"-"===t[0]))?"":JSON.stringify(e),created_at:t.created_at},r)}function sc(t){if(![$o,ko].includes(t.kind))return;let e,n;for(let r=t.tags.length-1;r>=0&&(void 0===e||void 0===n);r--){const s=t.tags[r];s.length>=2&&("e"===s[0]&&void 0===e?e=s:"p"===s[0]&&void 0===n&&(n=s))}return void 0!==e?{id:e[1],relays:[e[2],n?.[2]].filter((t=>"string"==typeof t)),author:n?.[1]}:void 0}function oc(t,{skipVerification:e}={}){const n=sc(t);if(void 0===n||""===t.content)return;let r;try{r=JSON.parse(t.content)}catch(t){return}return r.id===n.id&&(e||ao(r))?r:void 0}zs({},{finishRepostEvent:()=>rc,getRepostedEvent:()=>oc,getRepostedEventPointer:()=>sc});zs({},{NOSTR_URI_REGEX:()=>ic,parse:()=>cc,test:()=>ac});var ic=new RegExp(`nostr:(${na.source})`);function ac(t){return"string"==typeof t&&new RegExp(`^${ic.source}$`).test(t)}function cc(t){const e=t.match(new RegExp(`^${ic.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:sa(e[1])}}function lc(t,e,n){const r=e.tags.filter((t=>t.length>=2&&("e"===t[0]||"p"===t[0])));return io({...t,kind:_o,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function hc(t){if(t.kind!==_o)return;let e,n;for(let r=t.tags.length-1;r>=0&&(void 0===e||void 0===n);r--){const s=t.tags[r];s.length>=2&&("e"===s[0]&&void 0===e?e=s:"p"===s[0]&&void 0===n&&(n=s))}return void 0!==e&&void 0!==n?{id:e[1],relays:[e[2],n[2]].filter((t=>void 0!==t)),author:n[1]}:void 0}zs({},{finishReactionEvent:()=>lc,getReactedEventPointer:()=>hc});zs({},{parse:()=>fc});var uc=/\W/m,dc=/\W |\W$|$|,| /m;function*fc(t){const e=t.length;let n=0,r=0;for(;r<e;){let s=t.indexOf(":",r);if(-1===s)break;if("nostr"===t.substring(s-5,s)){const o=t.substring(s+60).match(uc),i=o?s+60+o.index:e;try{let e,{data:o,type:a}=sa(t.substring(s+1,i));switch(a){case"npub":e={pubkey:o};break;case"nsec":case"note":r=i+1;continue;default:e=o}n!==s-5&&(yield{type:"text",text:t.substring(n,s-5)}),yield{type:"reference",pointer:e},r=i,n=r;continue}catch(t){r=s+1;continue}}else if("https"===t.substring(s-5,s)||"http"===t.substring(s-4,s)){const o=t.substring(s+4).match(dc),i=o?s+4+o.index:e,a="s"===t[s-1]?5:4;try{let e=new URL(t.substring(s-a,i));if(-1===e.hostname.indexOf("."))throw new Error("invalid url");if(n!==s-a&&(yield{type:"text",text:t.substring(n,s-a)}),e.pathname.endsWith(".png")||e.pathname.endsWith(".jpg")||e.pathname.endsWith(".jpeg")||e.pathname.endsWith(".gif")||e.pathname.endsWith(".webp")){yield{type:"image",url:e.toString()},r=i,n=r;continue}if(e.pathname.endsWith(".mp4")||e.pathname.endsWith(".avi")||e.pathname.endsWith(".webm")||e.pathname.endsWith(".mkv")){yield{type:"video",url:e.toString()},r=i,n=r;continue}if(e.pathname.endsWith(".mp3")||e.pathname.endsWith(".aac")||e.pathname.endsWith(".ogg")||e.pathname.endsWith(".opus")){yield{type:"audio",url:e.toString()},r=i,n=r;continue}yield{type:"url",url:e.toString()},r=i,n=r;continue}catch(t){r=i+1;continue}}else{if("wss"!==t.substring(s-3,s)&&"ws"!==t.substring(s-2,s)){r=s+1;continue}{const o=t.substring(s+4).match(dc),i=o?s+4+o.index:e,a="s"===t[s-1]?3:2;try{let e=new URL(t.substring(s-a,i));if(-1===e.hostname.indexOf("."))throw new Error("invalid ws url");n!==s-a&&(yield{type:"text",text:t.substring(n,s-a)}),yield{type:"relay",url:e.toString()},r=i,n=r;continue}catch(t){r=i+1;continue}}}}n!==e&&(yield{type:"text",text:t.substring(n)})}zs({},{channelCreateEvent:()=>pc,channelHideMessageEvent:()=>wc,channelMessageEvent:()=>yc,channelMetadataEvent:()=>gc,channelMuteUserEvent:()=>mc});var pc=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return io({kind:Uo,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},gc=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return io({kind:Bo,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},yc=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),io({kind:Po,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},wc=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return io({kind:Co,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},mc=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return io({kind:Io,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)};zs({},{EMOJI_SHORTCODE_REGEX:()=>vc,matchAll:()=>Ec,regex:()=>bc,replaceAll:()=>$c});var vc=/:(\w+):/,bc=()=>new RegExp(`\\B${vc.source}\\B`,"g");function*Ec(t){const e=t.matchAll(bc());for(const t of e)try{const[e,n]=t;yield{shortcode:e,name:n,start:t.index,end:t.index+e.length}}catch(t){}}function $c(t,e){return t.replaceAll(bc(),((t,n)=>e({shortcode:t,name:n})))}var _c;zs({},{useFetchImplementation:()=>Ac,validateGithub:()=>xc});try{_c=fetch}catch{}function Ac(t){_c=t}async function xc(t,e,n){try{return await(await _c(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch(t){return!1}}function Sc(t){const{pathname:e,searchParams:n}=new URL(t),r=e,s=n.get("relay"),o=n.get("secret");if(!r||!s||!o)throw new Error("invalid connection string");return{pubkey:r,relay:s,secret:o}}async function kc(t,e,n){const r={method:"pay_invoice",params:{invoice:n}},s=await ga(e,t,JSON.stringify(r)),o={kind:hi,created_at:Math.round(Date.now()/1e3),content:s,tags:[["p",t]]};return io(o,e)}zs({},{makeNwcRequestEvent:()=>kc,parseConnectionString:()=>Sc});function Uc(t){return t=(t=t.trim().toLowerCase()).normalize("NFKC"),Array.from(t).map((t=>/\p{Letter}/u.test(t)||/\p{Number}/u.test(t)?t:"-")).join("")}zs({},{normalizeIdentifier:()=>Uc});var Bc;zs({},{getZapEndpoint:()=>Cc,makeZapReceipt:()=>Oc,makeZapRequest:()=>Ic,useFetchImplementation:()=>Pc,validateZapRequest:()=>Nc});try{Bc=fetch}catch{}function Pc(t){Bc=t}async function Cc(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:t}=ns.decode(n,1e3),r=ns.fromWords(t);e=Fs.decode(r)}else{if(!r)return null;{let[t,n]=r.split("@");e=new URL(`/.well-known/lnurlp/${t}`,`https://${n}`).toString()}}let s=await Bc(e),o=await s.json();if(o.allowsNostr&&o.nostrPubkey)return o.callback}catch(t){}return null}function Ic({profile:t,event:e,amount:n,relays:r,comment:s=""}){if(!n)throw new Error("amount not given");if(!t)throw new Error("profile not given");let o={kind:9734,created_at:Math.round(Date.now()/1e3),content:s,tags:[["p",t],["amount",n.toString()],["relays",...r]]};if(e&&"string"==typeof e&&o.tags.push(["e",e]),e&&"object"==typeof e)if(lo(e.kind)){const t=["a",`${e.kind}:${e.pubkey}:`];o.tags.push(t)}else if(uo(e.kind)){let t=e.tags.find((([t,e])=>"d"===t&&e));if(!t)throw new Error("d tag not found or is empty");const n=["a",`${e.kind}:${e.pubkey}:${t[1]}`];o.tags.push(n)}return o}function Nc(t){let e;try{e=JSON.parse(t)}catch(t){return"Invalid zap request JSON."}if(!Vs(e))return"Zap request is not a valid Nostr event.";if(!ao(e))return"Invalid signature on zap request.";let n=e.tags.find((([t,e])=>"p"===t&&e));if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find((([t,e])=>"e"===t&&e));if(r&&!r[1].match(/^[a-f0-9]{64}$/))return"Zap request 'e' tag is not valid hex.";let s=e.tags.find((([t,e])=>"relays"===t&&e));return s?null:"Zap request doesn't have a 'relays' tag."}function Oc({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let s=JSON.parse(t),o=s.tags.filter((([t])=>"e"===t||"p"===t||"a"===t)),i={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...o,["P",s.pubkey],["bolt11",n],["description",t]]};return e&&i.tags.push(["preimage",e]),i}zs({},{getToken:()=>Rc,hashPayload:()=>Wc,unpackEventFromToken:()=>Hc,validateEvent:()=>zc,validateEventKind:()=>Dc,validateEventMethodTag:()=>jc,validateEventPayloadTag:()=>qc,validateEventTimestamp:()=>Mc,validateEventUrlTag:()=>Kc,validateToken:()=>Lc});var Tc="Nostr ";async function Rc(t,e,n,r=!1,s){const o={kind:fi,tags:[["u",t],["method",e]],created_at:Math.round((new Date).getTime()/1e3),content:""};s&&o.tags.push(["payload",Wc(s)]);const i=await n(o);return(r?Tc:"")+zr.encode(Zs.encode(JSON.stringify(i)))}async function Lc(t,e,n){const r=await Hc(t).catch((t=>{throw t}));return await zc(r,e,n).catch((t=>{throw t}))}async function Hc(t){if(!t)throw new Error("Missing token");t=t.replace(Tc,"");const e=Fs.decode(zr.decode(t));if(!e||0===e.length||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function Mc(t){return!!t.created_at&&Math.round((new Date).getTime()/1e3)-t.created_at<60}function Dc(t){return t.kind===fi}function Kc(t,e){const n=t.tags.find((t=>"u"===t[0]));return!!n&&(n.length>0&&n[1]===e)}function jc(t,e){const n=t.tags.find((t=>"method"===t[0]));return!!n&&(n.length>0&&n[1].toLowerCase()===e.toLowerCase())}function Wc(t){return dr(Pr(Zs.encode(JSON.stringify(t))))}function qc(t,e){const n=t.tags.find((t=>"payload"===t[0]));if(!n)return!1;const r=Wc(e);return n.length>0&&n[1]===r}async function zc(t,e,n,r){if(!ao(t))throw new Error("Invalid nostr event, signature invalid");if(!Dc(t))throw new Error("Invalid nostr event, kind invalid");if(!Mc(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Kc(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!jc(t,n))throw new Error("Invalid nostr event, method tag invalid");if(Boolean(r)&&"object"==typeof r&&Object.keys(r).length>0&&!qc(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Gc(t,...e){if(!function(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Vc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Fc(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Zc(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Jc(t,e){return t<<32-e|t>>>e}const Yc=(()=>"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex)(),Qc=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Xc(t){if(Gc(t),Yc)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=Qc[t[n]];return e}const tl=48,el=57,nl=65,rl=70,sl=97,ol=102;function il(t){return t>=tl&&t<=el?t-tl:t>=nl&&t<=rl?t-(nl-10):t>=sl&&t<=ol?t-(sl-10):void 0}function al(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);if(Yc)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let e=0,s=0;e<n;e++,s+=2){const n=il(t.charCodeAt(s)),o=il(t.charCodeAt(s+1));if(void 0===n||void 0===o){const e=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+e+'" at index '+s)}r[e]=16*n+o}return r}function cl(t){return"string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(t))}(t)),Gc(t),t}class ll{}function hl(t){const e=e=>t().update(cl(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function ul(t,e,n){return t&e^~t&n}function dl(t,e,n){return t&e^t&n^e&n}class fl extends ll{constructor(t,e,n,r){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.buffer=new Uint8Array(t),this.view=Zc(this.buffer)}update(t){Vc(this),Gc(t=cl(t));const{view:e,buffer:n,blockLen:r}=this,s=t.length;for(let o=0;o<s;){const i=Math.min(r-this.pos,s-o);if(i!==r)n.set(t.subarray(o,o+i),this.pos),this.pos+=i,o+=i,this.pos===r&&(this.process(e,0),this.pos=0);else{const e=Zc(t);for(;r<=s-o;o+=r)this.process(e,o)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){Vc(this),function(t,e){Gc(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:r,isLE:s}=this;let{pos:o}=this;e[o++]=128,Fc(this.buffer.subarray(o)),this.padOffset>r-o&&(this.process(n,0),o=0);for(let t=o;t<r;t++)e[t]=0;!function(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const s=BigInt(32),o=BigInt(4294967295),i=Number(n>>s&o),a=Number(n&o),c=r?4:0,l=r?0:4;t.setUint32(e+c,i,r),t.setUint32(e+l,a,r)}(n,r-8,BigInt(8*this.length),s),this.process(n,0);const i=Zc(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<c;t++)i.setUint32(4*t,l[t],s)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:s,destroyed:o,pos:i}=this;return t.destroyed=o,t.finished=s,t.length=r,t.pos=i,r%e&&t.buffer.set(n),t}clone(){return this._cloneInto()}}const pl=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),gl=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),yl=new Uint32Array(64);class wl extends fl{constructor(t=32){super(64,t,8,!1),this.A=0|pl[0],this.B=0|pl[1],this.C=0|pl[2],this.D=0|pl[3],this.E=0|pl[4],this.F=0|pl[5],this.G=0|pl[6],this.H=0|pl[7]}get(){const{A:t,B:e,C:n,D:r,E:s,F:o,G:i,H:a}=this;return[t,e,n,r,s,o,i,a]}set(t,e,n,r,s,o,i,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|s,this.F=0|o,this.G=0|i,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)yl[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=yl[t-15],n=yl[t-2],r=Jc(e,7)^Jc(e,18)^e>>>3,s=Jc(n,17)^Jc(n,19)^n>>>10;yl[t]=s+yl[t-7]+r+yl[t-16]|0}let{A:n,B:r,C:s,D:o,E:i,F:a,G:c,H:l}=this;for(let t=0;t<64;t++){const e=l+(Jc(i,6)^Jc(i,11)^Jc(i,25))+ul(i,a,c)+gl[t]+yl[t]|0,h=(Jc(n,2)^Jc(n,13)^Jc(n,22))+dl(n,r,s)|0;l=c,c=a,a=i,i=o+e|0,o=s,s=r,r=n,n=e+h|0}n=n+this.A|0,r=r+this.B|0,s=s+this.C|0,o=o+this.D|0,i=i+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,s,o,i,a,c,l)}roundClean(){Fc(yl)}destroy(){this.set(0,0,0,0,0,0,0,0),Fc(this.buffer)}}const ml=hl((()=>new wl));function vl(t){const e=[0,t.pubkey,t.created_at,t.kind,t.tags,t.content],n=JSON.stringify(e);return Xc(ml((new TextEncoder).encode(n)))}function bl(t,e){try{if(!e||""===e.trim())throw new Error("Private key is empty or whitespace");if(t.id&&t.id.startsWith("test-"))return t;let n={kind:t.kind,pubkey:t.pubkey,created_at:t.created_at,tags:t.tags||[],content:t.content};const r=n.tags.find((t=>"nonce"===t[0]&&t.length>=3));if(r){const t=parseInt(r[2],10);!isNaN(t)&&t>0&&(n=function(t,e=0){if(e<=0)return t;console.log(`Calculating PoW with difficulty ${e} bits...`),console.time("PoW calculation");const n={...t};let r=-1;for(let t=0;t<n.tags.length;t++)if("nonce"===n.tags[t][0]){r=t;break}-1===r&&(n.tags.push(["nonce","0",e.toString()]),r=n.tags.length-1);const s=Math.ceil(e/4),o="0".repeat(s);let i=Math.floor(1e8*Math.random()),a="";const c={kind:n.kind,pubkey:n.pubkey,created_at:n.created_at,tags:[...n.tags],content:n.content};let l=0;const h=1e6;for(;l<h;){if(c.tags[r][1]=i.toString(),a=vl(c),a.startsWith(o)){console.log(`Found valid nonce after ${l} attempts: ${i}`),console.log(`Hash: ${a}`);break}i++,l++,l%1e4==0&&console.log(`Still calculating PoW... ${l} attempts so far`)}return l>=h&&console.warn(`Could not find valid nonce after 1000000 attempts. Using last nonce: ${i}`),n.tags[r][1]=i.toString(),console.timeEnd("PoW calculation"),n}(n,t))}let s;if(null==e)throw new Error("Private key is null or undefined");if("string"==typeof e){const t=e.startsWith("0x")?e.slice(2):e;if(64!==t.length)throw new Error(`Private key has invalid length: ${t.length}, expected 64`);if(!/^[0-9a-fA-F]+$/.test(t))throw new Error("Private key contains invalid characters");if(s=al(t),32!==s.length)throw new Error(`Private key bytes have invalid length: ${s.length}, expected 32`)}else{if(!(e instanceof Uint8Array))throw new Error("Private key has invalid type: "+typeof e);if(s=e,32!==s.length)throw new Error(`Private key bytes have invalid length: ${s.length}, expected 32`)}try{const t=io(n,s),e=t.tags.find((t=>"nonce"===t[0]&&t.length>=3));if(e){const t=parseInt(e[2],10);!isNaN(t)&&t>0&&console.log(`Calculating PoW for event with difficulty ${t}`)}return t}catch(t){return console.error("Error finalizing event:",t),n.id="fallback-"+Math.random().toString(36).substring(2,15),n.sig="fallback-signature",n}}catch(e){console.error("Error signing event:",e);return{...t,id:"error-"+Math.random().toString(36).substring(2,15),sig:"error-signature"}}}class El extends Xi{constructor(){super();const t=this.onnotice;this.onnotice=(e,n)=>{console.log(`Notice from relay ${e.url}: ${n}`),t&&t(e,n)};const e=this.onerror;this.onerror=(t,n)=>{console.error(`Error from relay ${t.url}:`,n),e&&e(t,n)};const n=this.onconnect;this.onconnect=t=>{console.log(`Connected to relay: ${t.url}`),n&&n(t)};const r=this.ondisconnect;this.ondisconnect=t=>{console.log(`Disconnected from relay: ${t.url}`),r&&r(t)}}publish(t,e){return console.log(`Publishing event to relays: ${t.join(", ")}`),super.publish(t,e)}subscribe(t,e,n){console.log(`Subscribing to relays: ${t.join(", ")} with filters:`,e);const r={onevent:t=>{try{n.onevent&&n.onevent(t)}catch(t){console.error("Error in onevent callback:",t)}},oneose:()=>{try{n.oneose&&n.oneose()}catch(t){console.error("Error in oneose callback:",t)}}};var s=super.subscribe(t,e,r);return console.log("Subscription result:",s),s}}let $l=null;function _l(t,e,n,r,s){if(!s)throw new Error("Private key is empty or undefined in createOrFindChannel");if(!r)throw new Error("Public key is empty or undefined in createOrFindChannel");if(!n)throw new Error("Channel ID is empty or undefined in createOrFindChannel");if(!t)throw new Error("Relay pool is empty or undefined in createOrFindChannel");if(!e||!Array.isArray(e)||0===e.length)throw new Error("Relays must be a non-empty array in createOrFindChannel");const o=String(s);return new Promise(((s,i)=>{try{console.log(`Searching for channel with ID: ${n} on relays:`,e);const a={kinds:[de],"#d":[n],limit:1};console.log("Using filter:",a);let c=!1,l=null;t.subscribe(e,a,{onevent(t){console.log("Found existing channel:",t),c=!0,l&&(clearTimeout(l),l=null),s(t)},oneose(){console.log("End of stored events for channel search"),c||(console.log("Channel not found in initial search, waiting briefly before creating..."),l=setTimeout((()=>{c||(console.log("Channel still not found, creating new channel"),function(t,e,n,r,s){return new Promise(((o,i)=>{try{if(!n)throw new Error("Invalid channelId");if(!r)throw new Error("Invalid userPublicKey");const a={kind:de,pubkey:r,created_at:Math.floor(Date.now()/1e3),tags:[["d",n],["name",n]],content:JSON.stringify({name:n,about:`Channel for ${n}`,picture:""})};if(!s)throw new Error("Private key is empty or undefined in createChannel");const c=String(s);console.log("Creating channel (kind 40 event):",{event:a,channelId:n,tags:a.tags,kind:de});try{const n=bl(a,c);console.log("Signed channel event:",n);try{console.log("Publishing channel to relays:",e),t.publish(e,n),o(n)}catch(t){console.error("Error publishing event:",t),i(t)}}catch(t){console.error("Error signing event:",t),i(t)}}catch(t){console.error("Error creating channel:",t),i(t)}}))}(t,e,n,r,o).then((t=>{s(t)})).catch((t=>{console.error("Error creating channel:",t),i(t)})))}),1e3))}})}catch(t){console.error("Exception in createOrFindChannel:",t),i(t)}}))}function Al(t){console.log("entering isImageUrl with url:",t);try{if(!t||"string"!=typeof t)return!1;if(t.includes('<a href="')&&t.includes('">')){const e=t.match(/<a href="([^"]+)"[^>]*>/i);e&&e[1]&&(t=e[1])}if(!t.startsWith("http://")&&!t.startsWith("https://"))return!1;if(t.includes(" ")||t.includes("\\"))return!1;try{const e=new URL(t).pathname.toLowerCase();return[".jpg",".jpeg",".png",".gif",".webp",".svg",".bmp"].some((t=>e.endsWith(t)))}catch(t){return!1}}catch(t){return console.log("Error checking if URL is an image:",t),!1}}const xl=new Map;function Sl(t,e=null){if(e){if(e.name)return e.name;if(e.display_name)return e.display_name}if(!e&&xl.has(t.pubkey)){const e=xl.get(t.pubkey);if(e.name)return e.name;if(e.display_name)return e.display_name}return t.pubkey.substring(0,8)+"..."}class kl extends ee{static properties={message:{type:Object},currentUserPubkey:{type:String,attribute:"current-user-pubkey"},relayPool:{type:Object},relays:{type:Array},showAvatars:{type:Boolean,attribute:"show-avatars"}};static styles=[ie];constructor(){super(),this.message=null,this.currentUserPubkey="",this.relayPool=null,this.relays=[],this.showAvatars=!0}connectedCallback(){super.connectedCallback(),this.message&&this.relayPool&&this.relays.length>0&&this._loadProfileInfo()}updated(t){(t.has("message")||t.has("relayPool")||t.has("relays"))&&this.message&&this.relayPool&&this.relays.length>0&&this._loadProfileInfo()}_loadProfileInfo(){var t,e,n,r;t=this.message.pubkey,e=this.relayPool,n=this.relays,r=t=>{t&&this.requestUpdate()},xl.has(t)?r(xl.get(t)):e.subscribe(n,[{kinds:[ue],authors:[t],limit:1}],{onevent(e){try{const n=JSON.parse(e.content);if(xl.set(t,n),r(n),xl.size>50){const t=xl.keys().next().value;xl.delete(t)}}catch(t){console.error("Error parsing profile info:",t),r(null)}},oneose(){xl.has(t)||r(null),console.log("Not closing profile subscription to maintain connection")}})}_getMessageClasses(){const t=["chat-message"];return this.message.isSystemMessage||"system"===this.message.pubkey?t.push("system-message"):this.message.pubkey===this.currentUserPubkey?t.push("self"):t.push("others"),t.join(" ")}_renderAvatar(){if(!this.showAvatars)return"";if(this.message.isSystemMessage||"system"===this.message.pubkey)return"";const t=function(t,e=null){if(e&&e.picture)return e.picture;if(!e&&xl.has(t.pubkey)){const e=xl.get(t.pubkey);if(e.picture)return e.picture}return null}(this.message),e=Sl(this.message),n=e.charAt(0).toUpperCase();return Tt`
      <div class="avatar-container">
        <div class="avatar">
          ${t?Tt`<img class="avatar-img" src="${t}" alt="${e}" @error=${this._handleAvatarError}>`:Tt`${n}`}
        </div>
      </div>
    `}_handleAvatarError(t){const e=Sl(this.message).charAt(0).toUpperCase();t.target.replaceWith(document.createTextNode(e))}render(){if(!this.message)return Tt``;const t=this.message.isSystemMessage||"system"===this.message.pubkey,e=Sl(this.message),n=function(t){return t?new Date(1e3*t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""}(this.message.created_at),r=t?this.message.content:function(t){if(!t)return"";let e=t.replace(/\n/g,"<br>");return e=e.replace(/<a\s+href="(https?:\/\/[^"]+)"[^>]*>.*?<\/a>/gi,(function(t,e){return Al(e)?`<a href="${e}" target="_blank" rel="noopener noreferrer">${e}</a><br><img src="${e}" alt="Bild" class="message-image">`:t})),e=e.replace(/(https?:\/\/[^\s<>"]+)/g,(function(t){return/<a\s+[^>]*href=[^>]*>.*?<\/a>/i.test(t)?t:Al(t)?`<a href="${t}" target="_blank" rel="noopener noreferrer">${t}</a><br><img src="${t}" alt="Bild" class="message-image">`:`<a href="${t}" target="_blank" rel="noopener noreferrer">${t}</a>`})),e}(this.message.content);return Tt`
      <div class=${this._getMessageClasses()} data-event-id=${this.message.id} data-pubkey=${this.message.pubkey}>
        ${t?Tt`
            <div class="message-content">
              <div class="message-text">${r}</div>
            </div>
          `:Tt`
            <div class="message-container">
              ${this._renderAvatar()}
              <div class="content-container">
                <div class="message-header">
                  <span class="username">${e}</span>
                  <span class="timestamp">${n}</span>
                </div>
                <div class="message-content">
                  <div class="message-text">${r}</div>
                </div>
                <div class="message-reactions"></div>
              </div>
            </div>
          `}
      </div>
    `}}customElements.define("message-item",kl);class Ul extends ee{static properties={messages:{type:Array},currentUserPubkey:{type:String,attribute:"current-user-pubkey"},relayPool:{type:Object},relays:{type:Array},showAvatars:{type:Boolean,attribute:"show-avatars"},loading:{type:Boolean}};static styles=[oe];constructor(){super(),this.messages=[],this.currentUserPubkey="",this.relayPool=null,this.relays=[],this.showAvatars=!0,this.loading=!1}updated(t){t.has("messages")&&this.messages.length>0&&this._scrollToBottom()}_scrollToBottom(){const t=this.shadowRoot.querySelector(".message-list");t&&setTimeout((()=>{t.scrollTop=t.scrollHeight}),0)}render(){return Tt`
      <div class="message-list">
        ${this.loading?Tt`<div class="loading-indicator"><div class="spinner"></div></div>`:""}
        ${this.messages.map((t=>Tt`
          <message-item 
            .message=${t}
            current-user-pubkey=${this.currentUserPubkey}
            .relayPool=${this.relayPool}
            .relays=${this.relays}
            ?show-avatars=${this.showAvatars}>
          </message-item>
        `))}
      </div>
    `}}customElements.define("message-list",Ul);class Bl extends ee{static properties={placeholder:{type:String},disabled:{type:Boolean},value:{type:String,state:!0}};static styles=[ae];constructor(){super(),this.placeholder="Nachricht eingeben...",this.disabled=!1,this.value=""}_handleInput(t){this.value=t.target.value}_handleKeyDown(t){"Enter"!==t.key||t.shiftKey||(t.preventDefault(),this._sendMessage())}_sendMessage(){if(!this.value.trim()||this.disabled)return;const t=new CustomEvent("message-send",{detail:{message:this.value},bubbles:!0,composed:!0});this.dispatchEvent(t),this.value=""}render(){return Tt`
      <div class="input-area">
        <textarea
          class="message-input"
          placeholder=${this.placeholder}
          ?disabled=${this.disabled}
          .value=${this.value}
          @input=${this._handleInput}
          @keydown=${this._handleKeyDown}
        ></textarea>
        <button
          class="send-button"
          ?disabled=${!this.value.trim()||this.disabled}
          @click=${this._sendMessage}
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
      </div>
    `}}customElements.define("input-area",Bl);class Pl extends ee{static properties={relay:{type:String,reflect:!0},channel:{type:String,reflect:!0},theme:{type:String,reflect:!0},showAvatars:{type:Boolean,attribute:"show-avatars",reflect:!0},maxMessages:{type:Number,attribute:"max-messages",reflect:!0},privateKey:{type:String,attribute:"private-key"},messages:{type:Array,state:!0},connected:{type:Boolean,state:!0},loading:{type:Boolean,state:!0},error:{type:String,state:!0},userPublicKey:{type:String,state:!0},relayPool:{type:Object,state:!0},relays:{type:Array,state:!0},processedEvents:{type:Set,state:!0},channelEventId:{type:String,state:!0}};static styles=le;constructor(){super(),this.relay=pe,this.channel=ge,this.theme=ye,this.showAvatars=we,this.maxMessages=me,this.privateKey="",this.messages=[],this.connected=!1,this.loading=!0,this.error="",this.userPublicKey="",this.relayPool=null,this.relays=[],this.processedEvents=new Set,this.channelEventId=null}connectedCallback(){super.connectedCallback(),this._initNostr()}disconnectedCallback(){super.disconnectedCallback()}updated(t){console.log("[DEBUG] updated - changedProperties:",Array.from(t.keys())),this.loading?console.log("[DEBUG] updated - Ignoring changes during loading"):((t.has("relay")||t.has("channel"))&&(console.log("[DEBUG] updated - Reconnecting due to relay or channel change"),this._reconnect()),t.has("privateKey")&&this.privateKey&&(console.log("[DEBUG] updated - Initializing with new private key"),this._initWithPrivateKey()))}async _initNostr(){try{this.loading=!0,console.log("[DEBUG] _initNostr - START"),this.relayPool=($l||($l=new El,console.log("Initializing relay pool",$l)),$l),console.log("[DEBUG] _initNostr - Relay pool initialized"),this.relays=[this.relay,...he.filter((t=>t!==this.relay))],console.log("[DEBUG] _initNostr - Relays set:",this.relays),console.log("[DEBUG] _initNostr - Checking privateKey:",this.privateKey);let t=!1;if(this.privateKey){console.log("[DEBUG] _initNostr - Using provided privateKey");try{await this._initWithPrivateKey(),t=!0}catch(t){console.error("[DEBUG] _initNostr - Error initializing with provided key:",t)}}if(t||(console.log("[DEBUG] _initNostr - Generating new key"),await this._initWithNewKey()),console.log("[DEBUG] _initNostr - Key initialized, privateKey:",this.privateKey?"set":"not set"),console.log("[DEBUG] _initNostr - userPublicKey:",this.userPublicKey),!this.privateKey)throw new Error("Private key is still empty after initialization");console.log("[DEBUG] _initNostr - Connecting to channel"),await this._connectToChannel(),console.log("[DEBUG] _initNostr - Connected to channel"),console.log("[DEBUG] _initNostr - Initialization complete"),this.loading=!1}catch(t){console.error("Error initializing Nostr:",t),this.error=`Error initializing Nostr: ${t.message}`,this.loading=!1}}async _initWithPrivateKey(){try{if(!this.privateKey)throw new Error("Private key is empty or undefined in _initWithPrivateKey");const t=String(this.privateKey);console.log("[DEBUG] _initWithPrivateKey - privateKeyStr:",t),this.userPublicKey=function(t){try{if(console.log("[DEBUG] getPublicKey - privateKey type:",typeof t),console.log("[DEBUG] getPublicKey - privateKey value:",t),"string"==typeof t&&t.startsWith("fallback")){const e="pub"+t.substring(8);return console.log("[DEBUG] getPublicKey - fallback pubKey:",e),e}let e;"string"==typeof t?(e=al(t.startsWith("0x")?t.slice(2):t),console.log("[DEBUG] getPublicKey - converted string to bytes, instanceof Uint8Array:",e instanceof Uint8Array)):(e=t,console.log("[DEBUG] getPublicKey - using original bytes, instanceof Uint8Array:",e instanceof Uint8Array));const n=oo(e);return console.log("[DEBUG] getPublicKey - derived pubKey:",n),n}catch(t){console.error("Error deriving public key:",t);const e="error"+Math.random().toString(36).substring(2,15).padEnd(64,"0");return console.log("[DEBUG] getPublicKey - error fallback pubKey:",e),e}}(t),this.privateKey=t,console.log("Initialized with provided private key, public key:",this.userPublicKey)}catch(t){console.error("Error initializing with private key:",t),this.error=`Error initializing with private key: ${t.message}`,await this._initWithNewKey()}}async _initWithNewKey(){try{const{privateKey:t,publicKey:e}=await async function(){try{const t=so();console.log("[DEBUG] generateKeyPair - privateKeyBytes type:",typeof t),console.log("[DEBUG] generateKeyPair - privateKeyBytes instanceof Uint8Array:",t instanceof Uint8Array);const e=Xc(t);console.log("[DEBUG] generateKeyPair - privateKeyHex type:",typeof e),console.log("[DEBUG] generateKeyPair - privateKeyHex value:",e);const n=oo(t);return console.log("[DEBUG] generateKeyPair - publicKeyHex:",n),{privateKey:e,publicKey:n}}catch(t){console.error("Error generating key pair:",t);const e="fallback"+Math.random().toString(36).substring(2,15).padEnd(64,"0"),n="fallback"+Math.random().toString(36).substring(2,15).padEnd(64,"0");return console.log("[DEBUG] generateKeyPair - fallback privateKey:",e),{privateKey:e,publicKey:n}}}();if(!t)throw new Error("Generated private key is empty or undefined");if(this.privateKey=t,this.userPublicKey=e,console.log("Generated new key pair, public key:",this.userPublicKey),!this.privateKey)throw new Error("Private key is still empty after setting it")}catch(t){throw console.error("Error generating key pair:",t),this.error=`Error generating key pair: ${t.message}`,t}}async _connectToChannel(){try{if(!this.privateKey)throw new Error("Private key is empty or undefined in _connectToChannel");const t=String(this.privateKey);console.log("[DEBUG] _connectToChannel - privateKeyStr:",t);const e=await _l(this.relayPool,this.relays,this.channel,this.userPublicKey,t);e&&e.id?(this.channelEventId=e.id,console.log("[DEBUG] _connectToChannel - Channel event ID:",this.channelEventId)):console.warn("[DEBUG] _connectToChannel - No channel event ID found"),function(t,e,n,r,s,o={},i=null){const a={kinds:[fe],limit:s?50:0};if(i?(a["#e"]=[i],console.log(`Adding channel event ID filter for ${i}`)):console.log("No channel event ID provided, using broader filter"),console.log("Creating subscription for channel messages with filter:",a),!n)throw new Error("Invalid channelId");const c=o.onEvent||(()=>{}),l=o.onEose||(()=>{});t.subscribe(e,a,{onevent(t){if(i){const e=t.tags.find((t=>"e"===t[0]));if(!e||e[1]!==i)return void console.log(`Skipping event with wrong e-tag: ${JSON.stringify(e)}, expected: ${i}`)}c(t)},oneose(){l()}})}(this.relayPool,this.relays,this.channel,this.userPublicKey,!0,{onEvent:t=>{console.log("[DEBUG] Channel event received:",t),this._processEvent(t)},onEose:()=>{console.log("[DEBUG] End of stored events"),0===this.messages.length?(console.log("[DEBUG] No messages, adding welcome message"),this._addWelcomeMessage()):console.log("[DEBUG] Messages found:",this.messages.length),this.loading=!1,console.log("[DEBUG] Loading set to false"),this.requestUpdate()}},this.channelEventId),this.connected=!0}catch(t){console.error("Error connecting to channel:",t),this.error=`Error connecting to channel: ${t.message}`,this.connected=!1}}_processEvent(t){console.log("[DEBUG] _processEvent - Received event:",t),console.log("[DEBUG] _processEvent - Event content:",t.content),console.log("[DEBUG] _processEvent - Event kind:",t.kind),console.log("[DEBUG] _processEvent - Event pubkey:",t.pubkey),this.processedEvents.has(t.id)?console.log("[DEBUG] _processEvent - Event already processed, skipping:",t.id):(this.processedEvents.add(t.id),console.log("[DEBUG] _processEvent - Added event to processed events, count:",this.processedEvents.size),this._addMessage(t),console.log("[DEBUG] _processEvent - Added message to list, count:",this.messages.length))}_addMessage(t){console.log("[DEBUG] _addMessage - Adding message:",t);const e=[...this.messages,t].sort(((t,e)=>t.created_at-e.created_at));console.log("[DEBUG] _addMessage - New messages array length:",e.length),e.length>this.maxMessages?(console.log("[DEBUG] _addMessage - Limiting messages to max:",this.maxMessages),this.messages=e.slice(e.length-this.maxMessages)):this.messages=e,console.log("[DEBUG] _addMessage - Final messages array:",this.messages),console.log("[DEBUG] _addMessage - Messages count:",this.messages.length),this.requestUpdate()}_addWelcomeMessage(){const t={id:"welcome-"+Date.now(),pubkey:"system",created_at:Math.floor(Date.now()/1e3),content:"Willkommen im Nostr-Chat! Sie können jetzt Nachrichten senden und empfangen.",tags:this.channelEventId?[["e",this.channelEventId,"","root"]]:[],kind:42,isSystemMessage:!0};this._addMessage(t)}async _handleMessageSend(t){try{const e=t.detail.message;if(!this.privateKey)throw new Error("Private key is empty or undefined in _handleMessageSend");const n=String(this.privateKey);console.log("[DEBUG] _handleMessageSend - privateKeyStr:",n),await function(t,e,n,r,s,o,i=null){return new Promise(((a,c)=>{try{if(!t||""===t.trim())return void c(new Error("Message content cannot be empty"));if(!r)throw new Error("Invalid channelId");if(!e)throw new Error("Invalid userPublicKey");const l={kind:fe,pubkey:e,created_at:Math.floor(Date.now()/1e3),tags:i?[["e",i,"","root"]]:[],content:t};if(!n)throw new Error("Private key is empty or undefined in sendMessage");const h=String(n);console.log("Sending kind 42 message (channel message):",{event:l,channelId:r,content:t,tags:l.tags,kind:fe});const u=bl(l,h);console.log("Signed event:",u);try{console.log("Publishing to relays:",o),s.publish(o,u),a(u)}catch(t){console.error("Error publishing message:",t),c(t)}}catch(t){console.error("Error sending message:",t),c(t)}}))}(e,this.userPublicKey,n,this.channel,this.relayPool,this.relays,this.channelEventId)}catch(t){console.error("Error sending message:",t),this.error=`Error sending message: ${t.message}`}}_reconnect(){this.loading=!0,this.messages=[],this.processedEvents.clear(),this._connectToChannel()}render(){return console.log("[DEBUG] render - messages:",this.messages),console.log("[DEBUG] render - connected:",this.connected),console.log("[DEBUG] render - loading:",this.loading),console.log("[DEBUG] render - error:",this.error),Tt`
      <div class="nostr-chat-container">
        <message-list
          .messages=${this.messages}
          current-user-pubkey=${this.userPublicKey}
          .relayPool=${this.relayPool}
          .relays=${this.relays}
          ?show-avatars=${this.showAvatars}
          ?loading=${this.loading}>
        </message-list>

        <input-area
          placeholder="Nachricht eingeben..."
          ?disabled=${!this.connected||this.loading}
          @message-send=${this._handleMessageSend}>
        </input-area>

        ${this.error?Tt`<div class="error-message">${this.error}</div>`:""}

        <!-- Debug-Ausgabe -->
        <div class="debug-info" style="font-size: 10px; color: #999; margin-top: 10px;">
          <p>Messages: ${this.messages.length}</p>
          <p>Connected: ${this.connected}</p>
          <p>Loading: ${this.loading}</p>
          <p>Public Key: ${this.userPublicKey}</p>
        </div>
      </div>
    `}}customElements.define("nostr-chat",Pl);export{Pl as NostrChat};
//# sourceMappingURL=nostr-chat.min.js.map
